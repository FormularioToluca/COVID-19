import * as tslib_1 from "tslib";
import { Component, ContentChild, ContentChildren, ElementRef, forwardRef, HostListener, Inject, Input, QueryList, Renderer2, TemplateRef, ViewChild } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { FormValidationMessageDirective } from '../form-validation-message.directive';
import { emptyFunction } from '../forms-util';
import { MultiSelectOptionDirective, MultiSelectTitleDirective } from '../form-multi-select/form-multi-select.component';
import { Subject } from 'rxjs';
import { FORM_SELECT_SELECTOR } from './form-custom-select.model';
import { FormSelectOptionComponent } from './form-select-option/form-select-option.component';
export function customSelectSelectorFactory() {
    return new Subject();
}
/**
 * This component offers a select field, that can be heavily customized.
 * The easy way would to just add options like this:
 * <rb-form-select-option [value]=""></rb-form-select-option>
 *
 * But you can also provide a selectionTpl which is a ng-template that is used to show the options in the dropdown.
 * It gets a context, that contains a select() function that can be used to provide the value for the ngModel.
 */
var FormCustomSelectComponent = /** @class */ (function () {
    function FormCustomSelectComponent(renderer, elementRef, selectSubject) {
        var _this = this;
        this.renderer = renderer;
        this.elementRef = elementRef;
        this.selectSubject = selectSubject;
        this.label = null;
        this.id = 'customSelectValue.' + Math.random();
        this.selectionTpl = null;
        this.autoClose = true;
        this.isMouseOver = false;
        this.onChange = emptyFunction;
        this.onTouched = emptyFunction;
        this.value = null;
        this.updateValue = function (value) {
            _this.value = value;
            _this.onChange(value);
            _this.checkValue(value);
        };
    }
    FormCustomSelectComponent_1 = FormCustomSelectComponent;
    FormCustomSelectComponent.prototype.ngOnInit = function () {
        var _this = this;
        this.selectSub = this.selectSubject.subscribe(function (action) {
            if (action.type === 'update') {
                _this.updateValue(action.value);
            }
        });
    };
    FormCustomSelectComponent.prototype.ngOnDestroy = function () {
        if (this.selectSub) {
            this.selectSub.unsubscribe();
        }
    };
    FormCustomSelectComponent.prototype.ngAfterViewInit = function () {
        this.updateCurrentLabel(this.value);
    };
    FormCustomSelectComponent.prototype.isLabelTemplate = function () {
        return this.label instanceof TemplateRef;
    };
    FormCustomSelectComponent.prototype.mouseover = function () {
        this.isMouseOver = true;
    };
    FormCustomSelectComponent.prototype.mouseleave = function () {
        this.isMouseOver = false;
    };
    FormCustomSelectComponent.prototype.writeValue = function (value) {
        this.value = value;
        this.selectSubject.next({ type: 'write', value: value });
        this.checkValue(value);
    };
    FormCustomSelectComponent.prototype.registerOnChange = function (fn) {
        this.onChange = fn;
    };
    FormCustomSelectComponent.prototype.registerOnTouched = function (fn) {
        this.onTouched = fn;
    };
    FormCustomSelectComponent.prototype.setDisabledState = function (isDisabled) {
        this.disabled = isDisabled;
    };
    FormCustomSelectComponent.prototype.checkValue = function (value) {
        if (typeof (value) === 'string' && value.length > 0 || typeof (value) === 'number' || typeof (value) === 'boolean' || value) {
            this.renderer.addClass(this.elementRef.nativeElement, 'not-empty');
        }
        else {
            this.renderer.removeClass(this.elementRef.nativeElement, 'not-empty');
        }
        this.updateCurrentLabel(value);
    };
    FormCustomSelectComponent.prototype.updateCurrentLabel = function (value) {
        if (this.options && this.options.length) {
            var opt = this.options.find(function (item) { return item.value === value; });
            if (opt) {
                this.activeElement.nativeElement.innerHTML = opt.content.nativeElement.innerHTML;
            }
        }
    };
    var FormCustomSelectComponent_1;
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", String)
    ], FormCustomSelectComponent.prototype, "name", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], FormCustomSelectComponent.prototype, "label", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", TemplateRef)
    ], FormCustomSelectComponent.prototype, "selectionTpl", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], FormCustomSelectComponent.prototype, "autoClose", void 0);
    tslib_1.__decorate([
        ContentChildren(FormValidationMessageDirective),
        tslib_1.__metadata("design:type", QueryList)
    ], FormCustomSelectComponent.prototype, "messages", void 0);
    tslib_1.__decorate([
        ContentChild(MultiSelectOptionDirective, { static: false }),
        tslib_1.__metadata("design:type", MultiSelectOptionDirective)
    ], FormCustomSelectComponent.prototype, "option", void 0);
    tslib_1.__decorate([
        ContentChild(MultiSelectTitleDirective, { static: false }),
        tslib_1.__metadata("design:type", MultiSelectTitleDirective)
    ], FormCustomSelectComponent.prototype, "title", void 0);
    tslib_1.__decorate([
        ContentChildren(FormSelectOptionComponent),
        tslib_1.__metadata("design:type", QueryList)
    ], FormCustomSelectComponent.prototype, "options", void 0);
    tslib_1.__decorate([
        ViewChild('activeElement', { static: true }),
        tslib_1.__metadata("design:type", ElementRef)
    ], FormCustomSelectComponent.prototype, "activeElement", void 0);
    tslib_1.__decorate([
        HostListener('mouseenter'),
        tslib_1.__metadata("design:type", Function),
        tslib_1.__metadata("design:paramtypes", []),
        tslib_1.__metadata("design:returntype", void 0)
    ], FormCustomSelectComponent.prototype, "mouseover", null);
    tslib_1.__decorate([
        HostListener('mouseleave'),
        tslib_1.__metadata("design:type", Function),
        tslib_1.__metadata("design:paramtypes", []),
        tslib_1.__metadata("design:returntype", void 0)
    ], FormCustomSelectComponent.prototype, "mouseleave", null);
    FormCustomSelectComponent = FormCustomSelectComponent_1 = tslib_1.__decorate([
        Component({
            selector: 'rb-form-custom-select',
            template: "<div class=\"input-wrapper\" [class.no-label]=\"!label\">\r\n\r\n  <button [rbDropdown]=\"dropdownContent\"\r\n          [id]=\"id\"\r\n          [autoClose]=\"autoClose\"\r\n          [disabled]=\"disabled !== undefined\"\r\n          (blur)=\"onTouched()\"\r\n          class=\"rb-select-btn input\">\r\n    <ng-container *ngIf=\"!options.length\">\r\n      <ng-container *ngTemplateOutlet=\"content\"></ng-container>\r\n    </ng-container>\r\n    <span #activeElement></span>\r\n  </button>\r\n\r\n  <label [for]=\"id\" class=\"label rb-select-label\">\r\n    {{!isLabelTemplate() ? label : ''}}\r\n    <ng-container *ngIf=\"isLabelTemplate()\">\r\n      <ng-container *ngTemplateOutlet=\"label\"></ng-container>\r\n    </ng-container>\r\n  </label>\r\n  <span class=\"select-icon rb-ic rb-ic-down\"></span>\r\n  <span class=\"input-background\"></span>\r\n</div>\r\n<rb-form-errors [messages]=\"messages\"></rb-form-errors>\r\n\r\n<ng-template #content>\r\n  <ng-content></ng-content>\r\n</ng-template>\r\n\r\n<ng-template #dropdownContent let-close=\"close\">\r\n  <ng-container *ngIf=\"options.length\">\r\n    <ng-container *ngTemplateOutlet=\"content\"></ng-container>\r\n  </ng-container>\r\n  <ng-container *ngTemplateOutlet=\"selectionTpl; context: {select: updateValue, close: close}\"></ng-container>\r\n</ng-template>\r\n",
            providers: [
                { provide: NG_VALUE_ACCESSOR, useExisting: forwardRef(function () { return FormCustomSelectComponent_1; }), multi: true },
                { provide: FORM_SELECT_SELECTOR, useFactory: customSelectSelectorFactory }
            ]
        }),
        tslib_1.__param(2, Inject(FORM_SELECT_SELECTOR)),
        tslib_1.__metadata("design:paramtypes", [Renderer2,
            ElementRef,
            Subject])
    ], FormCustomSelectComponent);
    return FormCustomSelectComponent;
}());
export { FormCustomSelectComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9ybS1jdXN0b20tc2VsZWN0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BpbnN0LWlvdC9ib3NjaC1hbmd1bGFyLXVpLWNvbXBvbmVudHMvIiwic291cmNlcyI6WyJhdG9tcy9mb3JtLWZpZWxkcy9mb3JtLWN1c3RvbS1zZWxlY3QvZm9ybS1jdXN0b20tc2VsZWN0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUVMLFNBQVMsRUFDVCxZQUFZLEVBQ1osZUFBZSxFQUNmLFVBQVUsRUFDVixVQUFVLEVBQ1YsWUFBWSxFQUNaLE1BQU0sRUFDTixLQUFLLEVBR0wsU0FBUyxFQUNULFNBQVMsRUFDVCxXQUFXLEVBQ1gsU0FBUyxFQUNWLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBd0IsaUJBQWlCLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUN6RSxPQUFPLEVBQUUsOEJBQThCLEVBQUUsTUFBTSxzQ0FBc0MsQ0FBQztBQUN0RixPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzlDLE9BQU8sRUFBRSwwQkFBMEIsRUFBRSx5QkFBeUIsRUFBRSxNQUFNLGtEQUFrRCxDQUFDO0FBQ3pILE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDL0IsT0FBTyxFQUFFLG9CQUFvQixFQUFvQixNQUFNLDRCQUE0QixDQUFDO0FBQ3BGLE9BQU8sRUFBRSx5QkFBeUIsRUFBRSxNQUFNLG1EQUFtRCxDQUFDO0FBRTlGLE1BQU0sVUFBVSwyQkFBMkI7SUFDekMsT0FBTyxJQUFJLE9BQU8sRUFBb0IsQ0FBQztBQUN6QyxDQUFDO0FBRUQ7Ozs7Ozs7R0FPRztBQVNIO0lBOEJFLG1DQUFvQixRQUFtQixFQUNuQixVQUFzQixFQUNRLGFBQXdDO1FBRjFGLGlCQVFDO1FBUm1CLGFBQVEsR0FBUixRQUFRLENBQVc7UUFDbkIsZUFBVSxHQUFWLFVBQVUsQ0FBWTtRQUNRLGtCQUFhLEdBQWIs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QzFDO1FBQTNCLFlBQVksQ0FBQyxZQUFZLENBQUM7Ozs7OERBRTFCO0lBRTJCO1FBQTNCLFlBQVksQ0FBQyxZQUFZLENBQUM7Ozs7K0RBRTFCO0lBcEVVLHlCQUF5QjtRQVJyQyxTQUFTLENBQUM7WUFDVCxRQUFRLEVBQUUsdUJBQXVCO1lBQ2pDLG0wQ0FBa0Q7WUFDbEQsU0FBUyxFQUFFO2dCQUNULEVBQUMsT0FBTyxFQUFFLGlCQUFpQixFQUFFLFdBQVcsRUFBRSxVQUFVLENBQUMsY0FBTSxPQUFBLDJCQUF5QixFQUF6QixDQUF5QixDQUFDLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBQztnQkFDbkcsRUFBQyxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsVUFBVSxFQUFFLDJCQUEyQixFQUFDO2FBQ3pFO1NBQ0YsQ0FBQztRQWlDYSxtQkFBQSxNQUFNLENBQUMsb0JBQW9CLENBQUMsQ0FBQTtpREFGWCxTQUFTO1lBQ1AsVUFBVTtZQUN1QixPQUFPO09BaEM3RCx5QkFBeUIsQ0E2R3JDO0lBQUQsZ0NBQUM7Q0FBQSxBQTdHRCxJQTZHQztTQTdHWSx5QkFBeUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xyXG4gIEFmdGVyVmlld0luaXQsXHJcbiAgQ29tcG9uZW50LFxyXG4gIENvbnRlbnRDaGlsZCxcclxuICBDb250ZW50Q2hpbGRyZW4sXHJcbiAgRWxlbWVudFJlZixcclxuICBmb3J3YXJkUmVmLFxyXG4gIEhvc3RMaXN0ZW5lcixcclxuICBJbmplY3QsXHJcbiAgSW5wdXQsXHJcbiAgT25EZXN0cm95LFxyXG4gIE9uSW5pdCxcclxuICBRdWVyeUxpc3QsXHJcbiAgUmVuZGVyZXIyLFxyXG4gIFRlbXBsYXRlUmVmLFxyXG4gIFZpZXdDaGlsZFxyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBDb250cm9sVmFsdWVBY2Nlc3NvciwgTkdfVkFMVUVfQUNDRVNTT1IgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XHJcbmltcG9ydCB7IEZvcm1WYWxpZGF0aW9uTWVzc2FnZURpcmVjdGl2ZSB9IGZyb20gJy4uL2Zvcm0tdmFsaWRhdGlvbi1tZXNzYWdlLmRpcmVjdGl2ZSc7XHJcbmltcG9ydCB7IGVtcHR5RnVuY3Rpb24gfSBmcm9tICcuLi9mb3Jtcy11dGlsJztcclxuaW1wb3J0IHsgTXVsdGlTZWxlY3RPcHRpb25EaXJlY3RpdmUsIE11bHRpU2VsZWN0VGl0bGVEaXJlY3RpdmUgfSBmcm9tICcuLi9mb3JtLW11bHRpLXNlbGVjdC9mb3JtLW11bHRpLXNlbGVjdC5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IEZPUk1fU0VMRUNUX1NFTEVDVE9SLCBGb3JtU2VsZWN0QWN0aW9uIH0gZnJvbSAnLi9mb3JtLWN1c3RvbS1zZWxlY3QubW9kZWwnO1xyXG5pbXBvcnQgeyBGb3JtU2VsZWN0T3B0aW9uQ29tcG9uZW50IH0gZnJvbSAnLi9mb3JtLXNlbGVjdC1vcHRpb24vZm9ybS1zZWxlY3Qtb3B0aW9uLmNvbXBvbmVudCc7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gY3VzdG9tU2VsZWN0U2VsZWN0b3JGYWN0b3J5KCkge1xyXG4gIHJldHVybiBuZXcgU3ViamVjdDxGb3JtU2VsZWN0QWN0aW9uPigpO1xyXG59XHJcblxyXG4vKipcclxuICogVGhpcyBjb21wb25lbnQgb2ZmZXJzIGEgc2VsZWN0IGZpZWxkLCB0aGF0IGNhbiBiZSBoZWF2aWx5IGN1c3RvbWl6ZWQuXHJcbiAqIFRoZSBlYXN5IHdheSB3b3VsZCB0byBqdXN0IGFkZCBvcHRpb25zIGxpa2UgdGhpczpcclxuICogPHJiLWZvcm0tc2VsZWN0LW9wdGlvbiBbdmFsdWVdPVwiXCI+PC9yYi1mb3JtLXNlbGVjdC1vcHRpb24+XHJcbiAqXHJcbiAqIEJ1dCB5b3UgY2FuIGFsc28gcHJvdmlkZSBhIHNlbGVjdGlvblRwbCB3aGljaCBpcyBhIG5nLXRlbXBsYXRlIHRoYXQgaXMgdXNlZCB0byBzaG93IHRoZSBvcHRpb25zIGluIHRoZSBkcm9wZG93bi5cclxuICogSXQgZ2V0cyBhIGNvbnRleHQsIHRoYXQgY29udGFpbnMgYSBzZWxlY3QoKSBmdW5jdGlvbiB0aGF0IGNhbiBiZSB1c2VkIHRvIHByb3ZpZGUgdGhlIHZhbHVlIGZvciB0aGUgbmdNb2RlbC5cclxuICovXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAncmItZm9ybS1jdXN0b20tc2VsZWN0JyxcclxuICB0ZW1wbGF0ZVVybDogJy4vZm9ybS1jdXN0b20tc2VsZWN0LmNvbXBvbmVudC5odG1sJyxcclxuICBwcm92aWRlcnM6IFtcclxuICAgIHtwcm92aWRlOiBOR19WQUxVRV9BQ0NFU1NPUiwgdXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gRm9ybUN1c3RvbVNlbGVjdENvbXBvbmVudCksIG11bHRpOiB0cnVlfSxcclxuICAgIHtwcm92aWRlOiBGT1JNX1NFTEVDVF9TRUxFQ1RPUiwgdXNlRmFjdG9yeTogY3VzdG9tU2VsZWN0U2VsZWN0b3JGYWN0b3J5fVxyXG4gIF1cclxufSlcclxuZXhwb3J0IGNsYXNzIEZvcm1DdXN0b21TZWxlY3RDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSwgQWZ0ZXJWaWV3SW5pdCwgQ29udHJvbFZhbHVlQWNjZXNzb3Ige1xyXG5cclxuICBASW5wdXQoKSBuYW1lOiBzdHJpbmc7XHJcblxyXG4gIEBJbnB1dCgpIGxhYmVsOiBzdHJpbmcgfCBUZW1wbGF0ZVJlZjxhbnk+ID0gbnVsbDtcclxuICBpZCA9ICdjdXN0b21TZWxlY3RWYWx1ZS4nICsgTWF0aC5yYW5kb20oKTtcclxuICBkaXNhYmxlZDogYm9vbGVhbjtcclxuXHJcbiAgQElucHV0KCkgc2VsZWN0aW9uVHBsOiBUZW1wbGF0ZVJlZjxhbnk+ID0gbnVsbDtcclxuICBASW5wdXQoKSBhdXRvQ2xvc2UgPSB0cnVlO1xyXG5cclxuICBAQ29udGVudENoaWxkcmVuKEZvcm1WYWxpZGF0aW9uTWVzc2FnZURpcmVjdGl2ZSkgbWVzc2FnZXM6IFF1ZXJ5TGlzdDxGb3JtVmFsaWRhdGlvbk1lc3NhZ2VEaXJlY3RpdmU+O1xyXG5cclxuICBwcml2YXRlIGlzTW91c2VPdmVyID0gZmFsc2U7XHJcblxyXG4gIEBDb250ZW50Q2hpbGQoTXVsdGlTZWxlY3RPcHRpb25EaXJlY3RpdmUsIHtzdGF0aWM6IGZhbHNlfSkgb3B0aW9uOiBNdWx0aVNlbGVjdE9wdGlvbkRpcmVjdGl2ZTtcclxuICBAQ29udGVudENoaWxkKE11bHRpU2VsZWN0VGl0bGVEaXJlY3RpdmUsIHtzdGF0aWM6IGZhbHNlfSkgdGl0bGU6IE11bHRpU2VsZWN0VGl0bGVEaXJlY3RpdmU7XHJcbiAgQENvbnRlbnRDaGlsZHJlbihGb3JtU2VsZWN0T3B0aW9uQ29tcG9uZW50KSBvcHRpb25zOiBRdWVyeUxpc3Q8Rm9ybVNlbGVjdE9wdGlvbkNvbXBvbmVudD47XHJcblxyXG4gIEBWaWV3Q2hpbGQoJ2FjdGl2ZUVsZW1lbnQnLCB7c3RhdGljOiB0cnVlfSkgYWN0aXZlRWxlbWVudDogRWxlbWVudFJlZjtcclxuXHJcbiAgb25DaGFuZ2UgPSBlbXB0eUZ1bmN0aW9uO1xyXG4gIG9uVG91Y2hlZCA9IGVtcHR5RnVuY3Rpb247XHJcblxyXG4gIHVwZGF0ZVZhbHVlO1xyXG5cclxuICBwcml2YXRlIHNlbGVjdFN1YjtcclxuXHJcbiAgcHJpdmF0ZSB2YWx1ZSA9IG51bGw7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVuZGVyZXI6IFJlbmRlcmVyMixcclxuICAgICAgICAgICAgICBwcml2YXRlIGVsZW1lbnRSZWY6IEVsZW1lbnRSZWYsXHJcbiAgICAgICAgICAgICAgQEluamVjdChGT1JNX1NFTEVDVF9TRUxFQ1RPUikgcHJpdmF0ZSBzZWxlY3RTdWJqZWN0OiBTdWJqZWN0PEZvcm1TZWxlY3RBY3Rpb24+KSB7XHJcbiAgICB0aGlzLnVwZGF0ZVZhbHVlID0gdmFsdWUgPT4ge1xyXG4gICAgICB0aGlzLnZhbHVlID0gdmFsdWU7XHJcbiAgICAgIHRoaXMub25DaGFuZ2UodmFsdWUpO1xyXG4gICAgICB0aGlzLmNoZWNrVmFsdWUodmFsdWUpO1xyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gICAgdGhpcy5zZWxlY3RTdWIgPSB0aGlzLnNlbGVjdFN1YmplY3Quc3Vic2NyaWJlKGFjdGlvbiA9PiB7XHJcbiAgICAgIGlmIChhY3Rpb24udHlwZSA9PT0gJ3VwZGF0ZScpIHtcclxuICAgICAgICB0aGlzLnVwZGF0ZVZhbHVlKGFjdGlvbi52YWx1ZSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XHJcbiAgICBpZiAodGhpcy5zZWxlY3RTdWIpIHtcclxuICAgICAgdGhpcy5zZWxlY3RTdWIudW5zdWJzY3JpYmUoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcclxuICAgIHRoaXMudXBkYXRlQ3VycmVudExhYmVsKHRoaXMudmFsdWUpO1xyXG4gIH1cclxuXHJcbiAgaXNMYWJlbFRlbXBsYXRlKCkge1xyXG4gICAgcmV0dXJuIHRoaXMubGFiZWwgaW5zdGFuY2VvZiBUZW1wbGF0ZVJlZjtcclxuICB9XHJcblxyXG4gIEBIb3N0TGlzdGVuZXIoJ21vdXNlZW50ZXInKSBtb3VzZW92ZXIoKSB7XHJcbiAgICB0aGlzLmlzTW91c2VPdmVyID0gdHJ1ZTtcclxuICB9XHJcblxyXG4gIEBIb3N0TGlzdGVuZXIoJ21vdXNlbGVhdmUnKSBtb3VzZWxlYXZlKCkge1xyXG4gICAgdGhpcy5pc01vdXNlT3ZlciA9IGZhbHNlO1xyXG4gIH1cclxuXHJcbiAgd3JpdGVWYWx1ZSh2YWx1ZTogYW55KTogdm9pZCB7XHJcbiAgICB0aGlzLnZhbHVlID0gdmFsdWU7XHJcbiAgICB0aGlzLnNlbGVjdFN1YmplY3QubmV4dCh7dHlwZTogJ3dyaXRlJywgdmFsdWV9KTtcclxuICAgIHRoaXMuY2hlY2tWYWx1ZSh2YWx1ZSk7XHJcbiAgfVxyXG5cclxuICByZWdpc3Rlck9uQ2hhbmdlKGZuOiAoXzogYW55KSA9PiB7fSk6IHZvaWQge1xyXG4gICAgdGhpcy5vbkNoYW5nZSA9IGZuO1xyXG4gIH1cclxuXHJcbiAgcmVnaXN0ZXJPblRvdWNoZWQoZm46ICgpID0+IHt9KTogdm9pZCB7XHJcbiAgICB0aGlzLm9uVG91Y2hlZCA9IGZuO1xyXG4gIH1cclxuXHJcbiAgc2V0RGlzYWJsZWRTdGF0ZShpc0Rpc2FibGVkOiBib29sZWFuKTogdm9pZCB7XHJcbiAgICB0aGlzLmRpc2FibGVkID0gaXNEaXNhYmxlZDtcclxuICB9XHJcblxyXG4gIGNoZWNrVmFsdWUodmFsdWUpIHtcclxuICAgIGlmICh0eXBlb2YgKHZhbHVlKSA9PT0gJ3N0cmluZycgJiYgdmFsdWUubGVuZ3RoID4gMCB8fCB0eXBlb2YgKHZhbHVlKSA9PT0gJ251bWJlcicgfHwgdHlwZW9mICh2YWx1ZSkgPT09ICdib29sZWFuJyB8fCB2YWx1ZSkge1xyXG4gICAgICB0aGlzLnJlbmRlcmVyLmFkZENsYXNzKHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LCAnbm90LWVtcHR5Jyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLnJlbmRlcmVyLnJlbW92ZUNsYXNzKHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LCAnbm90LWVtcHR5Jyk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy51cGRhdGVDdXJyZW50TGFiZWwodmFsdWUpO1xyXG5cclxuXHJcbiAgfVxyXG5cclxuICB1cGRhdGVDdXJyZW50TGFiZWwodmFsdWUpIHtcclxuICAgIGlmICh0aGlzLm9wdGlvbnMgJiYgdGhpcy5vcHRpb25zLmxlbmd0aCkge1xyXG4gICAgICBjb25zdCBvcHQgPSB0aGlzLm9wdGlvbnMuZmluZChpdGVtID0+IGl0ZW0udmFsdWUgPT09IHZhbHVlKTtcclxuICAgICAgaWYgKG9wdCkge1xyXG4gICAgICAgIHRoaXMuYWN0aXZlRWxlbWVudC5uYXRpdmVFbGVtZW50LmlubmVySFRNTCA9IG9wdC5jb250ZW50Lm5hdGl2ZUVsZW1lbnQuaW5uZXJIVE1MO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxufVxyXG4iXX0=