import * as tslib_1 from "tslib";
import { Component, ElementRef, EventEmitter, HostListener, Input, Output, TemplateRef, ViewChild } from '@angular/core';
import { getAbsolutePosition } from '../../utils/positionUtils';
var DropdownComponent = /** @class */ (function () {
    function DropdownComponent() {
        this.primaryPos = 'left';
        this.autoClose = true;
        this.hugContent = false;
        this.close = new EventEmitter();
        this.shown = false;
        this.updateContext({});
    }
    DropdownComponent.prototype.onAnyClick = function () {
        if (this.shown) {
            this.doClose('click');
        }
    };
    DropdownComponent.prototype.onClick = function (event) {
        event.stopPropagation();
        if (this.shown && this.autoClose) {
            this.doClose('click');
        }
    };
    DropdownComponent.prototype.onResize = function () {
        this.positionToAnchor();
    };
    DropdownComponent.prototype.ngOnInit = function () {
        var _this = this;
        setTimeout(function () {
            _this.positionToAnchor();
        });
        this.positionToAnchor();
    };
    DropdownComponent.prototype.show = function () {
        var _this = this;
        setTimeout(function () {
            _this.shown = true;
        });
        this.popoverElementRef.nativeElement.classList.add('open');
        this.positionToAnchor();
    };
    DropdownComponent.prototype.hide = function () {
        this.shown = false;
        this.popoverElementRef.nativeElement.classList.remove('open');
    };
    DropdownComponent.prototype.ngAfterViewChecked = function () {
        this.positionToAnchor();
    };
    DropdownComponent.prototype.positionToAnchor = function () {
        if (!this.anchor || !this.popoverElementRef) {
            return;
        }
        var a = this.anchor.nativeElement;
        var pop = this.popoverElementRef.nativeElement;
        var anchorPos = getAbsolutePosition(a);
        var viewTop = window.pageYOffset;
        var viewBottom = window.innerHeight + window.pageYOffset;
        var isBottom = true;
        if (!this.hugContent) {
            pop.style.minWidth = a.offsetWidth + 'px';
        }
        var pos = {
            x: anchorPos.x,
            y: 0
        };
        if (this.primaryPos === 'center') {
            pos.x += a.offsetWidth / 2 - pop.offsetWidth / 2;
        }
        if (this.primaryPos === 'right') {
            pos.x += a.offsetWidth - pop.offsetWidth;
        }
        pos.y = anchorPos.y + a.offsetHeight;
        if (pos.y + pop.offsetHeight > viewBottom) {
            isBottom = false;
        }
        if (!isBottom) {
            pos.y = anchorPos.y - pop.offsetHeight;
            if (pos.y < 0) {
                isBottom = true;
            }
        }
        if (isBottom) {
            pos.y = anchorPos.y + a.offsetHeight;
        }
        else {
        }
        if (pos.x + pop.offsetWidth > window.innerWidth) {
            pos.x = window.innerWidth - pop.offsetWidth;
        }
        if (pos.x < 0) {
            pos.x = 0;
        }
        var popParentPos = getAbsolutePosition(pop.offsetParent);
        pos.y -= popParentPos.y;
        pos.x -= popParentPos.x;
        pop.style.top = pos.y + 'px';
        pop.style.left = pos.x + 'px';
    };
    DropdownComponent.prototype.doClose = function (reason) {
        this.close.next(reason);
    };
    DropdownComponent.prototype.updateContext = function (ctx) {
        this.context = tslib_1.__assign({}, ctx, { close: this.doClose.bind(this) });
    };
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", ElementRef)
    ], DropdownComponent.prototype, "anchor", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", TemplateRef)
    ], DropdownComponent.prototype, "content", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", String)
    ], DropdownComponent.prototype, "primaryPos", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], DropdownComponent.prototype, "autoClose", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], DropdownComponent.prototype, "hugContent", void 0);
    tslib_1.__decorate([
        Output(),
        tslib_1.__metadata("design:type", Object)
    ], DropdownComponent.prototype, "close", void 0);
    tslib_1.__decorate([
        ViewChild('dropdown', { static: true }),
        tslib_1.__metadata("design:type", ElementRef)
    ], DropdownComponent.prototype, "popoverElementRef", void 0);
    tslib_1.__decorate([
        HostListener('window:click'),
        tslib_1.__metadata("design:type", Function),
        tslib_1.__metadata("design:paramtypes", []),
        tslib_1.__metadata("design:returntype", void 0)
    ], DropdownComponent.prototype, "onAnyClick", null);
    tslib_1.__decorate([
        HostListener('click', ['$event']),
        tslib_1.__metadata("design:type", Function),
        tslib_1.__metadata("design:paramtypes", [MouseEvent]),
        tslib_1.__metadata("design:returntype", void 0)
    ], DropdownComponent.prototype, "onClick", null);
    tslib_1.__decorate([
        HostListener('window:resize'),
        tslib_1.__metadata("design:type", Function),
        tslib_1.__metadata("design:paramtypes", []),
        tslib_1.__metadata("design:returntype", void 0)
    ], DropdownComponent.prototype, "onResize", null);
    DropdownComponent = tslib_1.__decorate([
        Component({
            selector: 'rb-dropdown',
            template: "<div class=\"dropdown\" #dropdown>\n  <div class=\"dropdown-content\">\n    <ng-container *ngTemplateOutlet=\"content; context: context\"></ng-container>\n  </div>\n</div>\n"
        }),
        tslib_1.__metadata("design:paramtypes", [])
    ], DropdownComponent);
    return DropdownComponent;
}());
export { DropdownComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJvcGRvd24uY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGluc3QtaW90L2Jvc2NoLWFuZ3VsYXItdWktY29tcG9uZW50cy8iLCJzb3VyY2VzIjpbImF0b21zL2Ryb3Bkb3duL2Ryb3Bkb3duLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUVMLFNBQVMsRUFDVCxVQUFVLEVBQ1YsWUFBWSxFQUNaLFlBQVksRUFDWixLQUFLLEVBRUwsTUFBTSxFQUNOLFdBQVcsRUFDWCxTQUFTLEVBQ1YsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFNaEU7SUFrQ0U7UUE5QlMsZUFBVSxHQUFnQyxNQUFNLENBQUM7UUFDakQsY0FBUyxHQUFHLElBQUksQ0FBQztRQUNqQixlQUFVLEdBQUcsS0FBSyxDQUFDO1FBRWxCLFVBQUssR0FBRyxJQUFJLFlBQVksRUFBVSxDQUFDO1FBRTdDLFVBQUssR0FBRyxLQUFLLENBQUM7UUF5QlosSUFBSSxDQUFDLGFBQWEsQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUN6QixDQUFDO0lBcEI2QixzQ0FBVSxHQUFWO1FBQzVCLElBQUksSUFBSSxDQUFDLEtBQUssRUFBRTtZQUNkLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7U0FDdkI7SUFDSCxDQUFDO0lBRWtDLG1DQUFPLEdBQVAsVUFBUSxLQUFpQjtRQUMxRCxLQUFLLENBQUMsZUFBZSxFQUFFLENBQUM7UUFDeEIsSUFBSSxJQUFJLENBQUMsS0FBSyxJQUFJLElBQUksQ0FBQyxTQUFTLEVBQUU7WUFDaEMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQztTQUN2QjtJQUNILENBQUM7SUFFOEIsb0NBQVEsR0FBUjtRQUM3QixJQUFJLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztJQUMxQixDQUFDO0lBT0Qsb0NBQVEsR0FBUjtRQUFBLGlCQUtDO1FB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UyxDQUFDLFVBQVUsRUFBRSxFQUFDLE1BQU0sRUFBRSxJQUFJLEVBQUMsQ0FBQzswQ0FBb0IsVUFBVTtnRUFBQztJQUV2QztRQUE3QixZQUFZLENBQUMsY0FBYyxDQUFDOzs7O3VEQUk1QjtJQUVrQztRQUFsQyxZQUFZLENBQUMsT0FBTyxFQUFFLENBQUMsUUFBUSxDQUFDLENBQUM7O2lEQUFnQixVQUFVOztvREFLM0Q7SUFFOEI7UUFBOUIsWUFBWSxDQUFDLGVBQWUsQ0FBQzs7OztxREFFN0I7SUEvQlUsaUJBQWlCO1FBSjdCLFNBQVMsQ0FBQztZQUNULFFBQVEsRUFBRSxhQUFhO1lBQ3ZCLHlMQUF3QztTQUN6QyxDQUFDOztPQUNXLGlCQUFpQixDQWtJN0I7SUFBRCx3QkFBQztDQUFBLEFBbElELElBa0lDO1NBbElZLGlCQUFpQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgQWZ0ZXJWaWV3Q2hlY2tlZCxcclxuICBDb21wb25lbnQsXHJcbiAgRWxlbWVudFJlZixcclxuICBFdmVudEVtaXR0ZXIsXHJcbiAgSG9zdExpc3RlbmVyLFxyXG4gIElucHV0LFxyXG4gIE9uSW5pdCxcclxuICBPdXRwdXQsXHJcbiAgVGVtcGxhdGVSZWYsXHJcbiAgVmlld0NoaWxkXHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IGdldEFic29sdXRlUG9zaXRpb24gfSBmcm9tICcuLi8uLi91dGlscy9wb3NpdGlvblV0aWxzJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAncmItZHJvcGRvd24nLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9kcm9wZG93bi5jb21wb25lbnQuaHRtbCdcclxufSlcclxuZXhwb3J0IGNsYXNzIERyb3Bkb3duQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdDaGVja2VkIHtcclxuXHJcbiAgQElucHV0KCkgYW5jaG9yOiBFbGVtZW50UmVmO1xyXG4gIEBJbnB1dCgpIGNvbnRlbnQ6IFRlbXBsYXRlUmVmPGFueT47XHJcbiAgQElucHV0KCkgcHJpbWFyeVBvczogJ2xlZnQnIHwgJ3JpZ2h0JyB8ICdjZW50ZXInID0gJ2xlZnQnO1xyXG4gIEBJbnB1dCgpIGF1dG9DbG9zZSA9IHRydWU7XHJcbiAgQElucHV0KCkgaHVnQ29udGVudCA9IGZhbHNlO1xyXG5cclxuICBAT3V0cHV0KCkgY2xvc2UgPSBuZXcgRXZlbnRFbWl0dGVyPHN0cmluZz4oKTtcclxuXHJcbiAgc2hvd24gPSBmYWxzZTtcclxuXHJcbiAgY29udGV4dDogUmVjb3JkPHN0cmluZywgYW55PjtcclxuXHJcbiAgQFZpZXdDaGlsZCgnZHJvcGRvd24nLCB7c3RhdGljOiB0cnVlfSkgcG9wb3ZlckVsZW1lbnRSZWY6IEVsZW1lbnRSZWY7XHJcblxyXG4gIEBIb3N0TGlzdGVuZXIoJ3dpbmRvdzpjbGljaycpIG9uQW55Q2xpY2soKSB7XHJcbiAgICBpZiAodGhpcy5zaG93bikge1xyXG4gICAgICB0aGlzLmRvQ2xvc2UoJ2NsaWNrJyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBASG9zdExpc3RlbmVyKCdjbGljaycsIFsnJGV2ZW50J10pIG9uQ2xpY2soZXZlbnQ6IE1vdXNlRXZlbnQpIHtcclxuICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgaWYgKHRoaXMuc2hvd24gJiYgdGhpcy5hdXRvQ2xvc2UpIHtcclxuICAgICAgdGhpcy5kb0Nsb3NlKCdjbGljaycpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgQEhvc3RMaXN0ZW5lcignd2luZG93OnJlc2l6ZScpIG9uUmVzaXplKCkge1xyXG4gICAgdGhpcy5wb3NpdGlvblRvQW5jaG9yKCk7XHJcbiAgfVxyXG5cclxuXHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICB0aGlzLnVwZGF0ZUNvbnRleHQoe30pO1xyXG4gIH1cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgdGhpcy5wb3NpdGlvblRvQW5jaG9yKCk7XHJcbiAgICB9KTtcclxuICAgIHRoaXMucG9zaXRpb25Ub0FuY2hvcigpO1xyXG4gIH1cclxuXHJcbiAgc2hvdygpIHtcclxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICB0aGlzLnNob3duID0gdHJ1ZTtcclxuICAgIH0pO1xyXG4gICAgdGhpcy5wb3BvdmVyRWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ29wZW4nKTtcclxuICAgIHRoaXMucG9zaXRpb25Ub0FuY2hvcigpO1xyXG4gIH1cclxuXHJcbiAgaGlkZSgpIHtcclxuICAgIHRoaXMuc2hvd24gPSBmYWxzZTtcclxuICAgIHRoaXMucG9wb3ZlckVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdvcGVuJyk7XHJcbiAgfVxyXG5cclxuICBuZ0FmdGVyVmlld0NoZWNrZWQoKTogdm9pZCB7XHJcbiAgICB0aGlzLnBvc2l0aW9uVG9BbmNob3IoKTtcclxuICB9XHJcblxyXG4gIHBvc2l0aW9uVG9BbmNob3IoKSB7XHJcbiAgICBpZiAoIXRoaXMuYW5jaG9yIHx8ICF0aGlzLnBvcG92ZXJFbGVtZW50UmVmKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGNvbnN0IGEgPSB0aGlzLmFuY2hvci5uYXRpdmVFbGVtZW50O1xyXG4gICAgY29uc3QgcG9wID0gdGhpcy5wb3BvdmVyRWxlbWVudFJlZi5uYXRpdmVFbGVtZW50O1xyXG5cclxuICAgIGNvbnN0IGFuY2hvclBvcyA9IGdldEFic29sdXRlUG9zaXRpb24oYSk7XHJcbiAgICBjb25zdCB2aWV3VG9wID0gd2luZG93LnBhZ2VZT2Zmc2V0O1xyXG4gICAgY29uc3Qgdmlld0JvdHRvbSA9IHdpbmRvdy5pbm5lckhlaWdodCArIHdpbmRvdy5wYWdlWU9mZnNldDtcclxuICAgIGxldCBpc0JvdHRvbSA9IHRydWU7XHJcblxyXG4gICAgaWYgKCF0aGlzLmh1Z0NvbnRlbnQpIHtcclxuICAgICAgcG9wLnN0eWxlLm1pbldpZHRoID0gYS5vZmZzZXRXaWR0aCArICdweCc7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgcG9zID0ge1xyXG4gICAgICB4OiBhbmNob3JQb3MueCxcclxuICAgICAgeTogMFxyXG4gICAgfTtcclxuICAgIGlmICh0aGlzLnByaW1hcnlQb3MgPT09ICdjZW50ZXInKSB7XHJcbiAgICAgIHBvcy54ICs9IGEub2Zmc2V0V2lkdGggLyAyIC0gcG9wLm9mZnNldFdpZHRoIC8gMjtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLnByaW1hcnlQb3MgPT09ICdyaWdodCcpIHtcclxuICAgICAgcG9zLnggKz0gYS5vZmZzZXRXaWR0aCAtIHBvcC5vZmZzZXRXaWR0aDtcclxuICAgIH1cclxuICAgIHBvcy55ID0gYW5jaG9yUG9zLnkgKyBhLm9mZnNldEhlaWdodDtcclxuICAgIGlmIChwb3MueSArIHBvcC5vZmZzZXRIZWlnaHQgPiB2aWV3Qm90dG9tKSB7XHJcbiAgICAgIGlzQm90dG9tID0gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBpZiAoIWlzQm90dG9tKSB7XHJcbiAgICAgIHBvcy55ID0gYW5jaG9yUG9zLnkgLSBwb3Aub2Zmc2V0SGVpZ2h0O1xyXG4gICAgICBpZiAocG9zLnkgPCAwKSB7XHJcbiAgICAgICAgaXNCb3R0b20gPSB0cnVlO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAoaXNCb3R0b20pIHtcclxuICAgICAgcG9zLnkgPSBhbmNob3JQb3MueSArIGEub2Zmc2V0SGVpZ2h0O1xyXG4gICAgfSBlbHNlIHtcclxuICAgIH1cclxuXHJcbiAgICBpZiAocG9zLnggKyBwb3Aub2Zmc2V0V2lkdGggPiB3aW5kb3cuaW5uZXJXaWR0aCkge1xyXG4gICAgICBwb3MueCA9IHdpbmRvdy5pbm5lcldpZHRoIC0gcG9wLm9mZnNldFdpZHRoO1xyXG4gICAgfVxyXG4gICAgaWYgKHBvcy54IDwgMCkge1xyXG4gICAgICBwb3MueCA9IDA7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgcG9wUGFyZW50UG9zID0gZ2V0QWJzb2x1dGVQb3NpdGlvbihwb3Aub2Zmc2V0UGFyZW50KTtcclxuICAgIHBvcy55IC09IHBvcFBhcmVudFBvcy55O1xyXG4gICAgcG9zLnggLT0gcG9wUGFyZW50UG9zLng7XHJcblxyXG4gICAgcG9wLnN0eWxlLnRvcCA9IHBvcy55ICsgJ3B4JztcclxuICAgIHBvcC5zdHlsZS5sZWZ0ID0gcG9zLnggKyAncHgnO1xyXG5cclxuICB9XHJcblxyXG4gIGRvQ2xvc2UocmVhc29uPykge1xyXG4gICAgdGhpcy5jbG9zZS5uZXh0KHJlYXNvbik7XHJcbiAgfVxyXG5cclxuICB1cGRhdGVDb250ZXh0KGN0eDogUmVjb3JkPHN0cmluZywgYW55Pikge1xyXG4gICAgdGhpcy5jb250ZXh0ID0ge1xyXG4gICAgICAuLi5jdHgsXHJcbiAgICAgIGNsb3NlOiB0aGlzLmRvQ2xvc2UuYmluZCh0aGlzKVxyXG4gICAgfTtcclxuICB9XHJcblxyXG59XHJcbiJdfQ==