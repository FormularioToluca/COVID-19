import * as tslib_1 from "tslib";
import { Component, ContentChildren, ElementRef, EventEmitter, HostListener, Inject, InjectionToken, Input, Optional, Output, QueryList, Renderer2, ViewChild } from '@angular/core';
import { TabPanelItemDirective } from './tab-panel-item.directive';
export var TAB_PANEL_RESOLVER = new InjectionToken('TabPanelResolver');
/**
 * A very powerful tab panel component.
 * It can handle dynamic tabs, the tab bar can accept all kind of types. See: TabPanelItemType
 * When you provide `outletName`, you should provide your router config with such an entry to enable the outlet routing:
 * children: [{path: ':id', outlet: 'yourOutletName', component: TabPanelComponent}]
 */
var TabPanelComponent = /** @class */ (function () {
    function TabPanelComponent(renderer, element, tabPanelResolver) {
        this.renderer = renderer;
        this.element = element;
        this.tabPanelResolver = tabPanelResolver;
        this.tabChanged = new EventEmitter();
        this.tabItems = [];
        /**
         * Whether tabs that were opened once, should be kept in the DOM
         * when switching away from them. Or should they be removed from
         * DOM when switched to another tab?
         */
        this.destroyTabs = false;
        this.renderHiddenTabs = false;
        this.lastHeight = 0;
    }
    Object.defineProperty(TabPanelComponent.prototype, "tabItemsQuery", {
        set: function (tabItems) {
            var _this = this;
            this.tabItems = tabItems.toArray();
            if (this.outletName) {
                this.tabItems.forEach(function (tabItem) {
                    var link = { outlets: {} };
                    link.outlets[_this.outletName] = [tabItem.id];
                    tabItem.routerLink = [link];
                });
            }
            if (this.tabItems.length && this.tabItems.every(function (tabItem) { return !tabItem.active; })) {
                if (this.tab) {
                    this.showTab(this.tab);
                }
                else {
                    this.showFirstTab();
                }
            }
            this.tabItemsLeft = this.tabItems.filter(function (tabItem) { return tabItem.position === 'left'; });
            this.tabItemsCenter = this.tabItems.filter(function (tabItem) { return tabItem.position === 'center'; });
            this.tabItemsRight = this.tabItems.filter(function (tabItem) { return tabItem.position === 'right'; });
        },
        enumerable: true,
        configurable: true
    });
    TabPanelComponent.prototype.ngAfterViewInit = function () {
        this.onResize();
    };
    TabPanelComponent.prototype.ngOnChanges = function (changes) {
        if (changes.tab && changes.tab.currentValue && !changes.tab.firstChange) {
            var found = this.tabItems.find(function (tabItem) { return tabItem.id === changes.tab.currentValue; });
            if (found && !found.active) {
                this.showTab(changes.tab.currentValue);
            }
        }
    };
    TabPanelComponent.prototype.ngDoCheck = function () {
        if (this.element && this.element.nativeElement.classList.contains('full-width')) {
            this.onResize();
        }
    };
    TabPanelComponent.prototype.showFirstTab = function () {
        var firstItem = this.tabItems.find(function (tabItem) { return tabItem.type === 'tab'; });
        if (firstItem) {
            this.showTab(firstItem.id);
        }
    };
    /**
     * Can be used to show a certain tab.
     */
    TabPanelComponent.prototype.showTab = function (id) {
        var _this = this;
        var found = this.tabItems.find(function (tabItem) { return tabItem.id === id; });
        if (!found) {
            // wait a tick
            setTimeout(function () {
                _this.deactivateAndShowTab(id);
            });
        }
        else {
            this.deactivateAndShowTab(id);
        }
    };
    TabPanelComponent.prototype.deactivateAndShowTab = function (id) {
        var _this = this;
        this.tabItems.forEach(function (tabItem) {
            if (tabItem.active && tabItem.id !== id) {
                tabItem.hide();
            }
            else if (tabItem.id === id) {
                tabItem.show();
                _this.tabChanged.next(id);
            }
        });
    };
    TabPanelComponent.prototype.onResize = function () {
        if (this.panelPlaceholder && this.tabPanel) {
            var tabPanelHeight = this.tabPanel.nativeElement.offsetHeight;
            if (Math.abs(this.lastHeight - tabPanelHeight) > 2) {
                this.lastHeight = tabPanelHeight;
                this.renderer.setStyle(this.panelPlaceholder.nativeElement, 'height', tabPanelHeight + 'px');
            }
        }
    };
    tslib_1.__decorate([
        Output(),
        tslib_1.__metadata("design:type", Object)
    ], TabPanelComponent.prototype, "tabChanged", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", String)
    ], TabPanelComponent.prototype, "tab", void 0);
    tslib_1.__decorate([
        ViewChild('panelPlaceholder', { static: true }),
        tslib_1.__metadata("design:type", ElementRef)
    ], TabPanelComponent.prototype, "panelPlaceholder", void 0);
    tslib_1.__decorate([
        ViewChild('tabPanel', { static: true }),
        tslib_1.__metadata("design:type", ElementRef)
    ], TabPanelComponent.prototype, "tabPanel", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], TabPanelComponent.prototype, "destroyTabs", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], TabPanelComponent.prototype, "renderHiddenTabs", void 0);
    tslib_1.__decorate([
        ContentChildren(TabPanelItemDirective),
        tslib_1.__metadata("design:type", QueryList),
        tslib_1.__metadata("design:paramtypes", [QueryList])
    ], TabPanelComponent.prototype, "tabItemsQuery", null);
    tslib_1.__decorate([
        HostListener('window:resize'),
        tslib_1.__metadata("design:type", Function),
        tslib_1.__metadata("design:paramtypes", []),
        tslib_1.__metadata("design:returntype", void 0)
    ], TabPanelComponent.prototype, "onResize", null);
    TabPanelComponent = tslib_1.__decorate([
        Component({
            selector: 'rb-tab-panel',
            template: "<div class=\"tab-panel-container\">\r\n  <div class=\"tab-panel limit\" #tabPanel>\r\n    <rb-navigation type=\"tab\" class=\"tab-panel-left\">\r\n      <ng-container *ngFor=\"let tabItem of tabItemsLeft; template: tabTpl\"></ng-container>\r\n    </rb-navigation>\r\n    <rb-navigation type=\"tab\" class=\"tab-panel-center\">\r\n      <ng-container *ngFor=\"let tabItem of tabItemsCenter; template: tabTpl\"></ng-container>\r\n    </rb-navigation>\r\n    <rb-navigation type=\"tab\" class=\"tab-panel-right\">\r\n      <ng-container *ngFor=\"let tabItem of tabItemsRight; template: tabTpl\"></ng-container>\r\n    </rb-navigation>\r\n  </div>\r\n</div>\r\n<div class=\"tab-panel-placeholder\" #panelPlaceholder></div>\r\n\r\n<ng-container *ngFor=\"let tabItem of tabItems\">\r\n  <div class=\"tab-content\" *ngIf=\"destroyTabs && tabItem.active || !destroyTabs && tabItem.shown || renderHiddenTabs\"\r\n       [hidden]=\"!tabItem.active\">\r\n    <ng-container *ngTemplateOutlet=\"tabItem.templateRef; context: tabItem\"></ng-container>\r\n  </div>\r\n</ng-container>\r\n\r\n<ng-template #tabTpl let-tabItem>\r\n  <ng-container *ngIf=\"tabItem.type === 'dropdown'\">\r\n    <a href=\"javascript:\" class=\"rb-dropdown-toggle\"\r\n       [class.active]=\"tabItem.active\"\r\n       [rbDropdown]=\"tabItem.templateRef\"\r\n       [position]=\"tabItem.position\"\r\n       [autoClose]=\"tabItem.autoClose\">\r\n      <ng-container *ngIf=\"tabItem.titleStr\">\r\n        {{tabItem.titleStr}}\r\n      </ng-container>\r\n      <ng-container *ngIf=\"tabItem.titleTpl\">\r\n        <ng-container\r\n          *ngTemplateOutlet=\"tabItem.titleTpl; context: tabItem\"></ng-container>\r\n      </ng-container>\r\n    </a>\r\n  </ng-container>\r\n  <ng-container *ngIf=\"tabItem.type === 'content'\">\r\n    <ng-container *ngIf=\"tabItem.titleStr\">\r\n      {{tabItem.titleStr}}\r\n    </ng-container>\r\n    <ng-container *ngIf=\"tabItem.titleTpl\">\r\n      <ng-container\r\n        *ngTemplateOutlet=\"tabItem.titleTpl; context: tabItem\"></ng-container>\r\n    </ng-container>\r\n    <ng-container\r\n      *ngTemplateOutlet=\"tabItem.templateRef; context: tabItem\"></ng-container>\r\n  </ng-container>\r\n  <ng-container *ngIf=\"tabItem.type === 'custom'\">\r\n    <ng-container *ngIf=\"tabItem.titleStr\">\r\n      {{tabItem.titleStr}}\r\n    </ng-container>\r\n    <ng-container *ngIf=\"tabItem.titleTpl\">\r\n      <ng-container\r\n        *ngTemplateOutlet=\"tabItem.titleTpl; context: tabItem\"></ng-container>\r\n    </ng-container>\r\n  </ng-container>\r\n  <ng-container *ngIf=\"tabItem.type === 'tab'\">\r\n    <a href=\"javascript:\" [class.active]=\"tabItem.active\" (click)=\"showTab(tabItem.id)\">\r\n      <ng-container *ngIf=\"tabItem.titleStr\">\r\n        {{tabItem.titleStr}}\r\n      </ng-container>\r\n      <ng-container *ngIf=\"tabItem.titleTpl\">\r\n        <ng-container\r\n          *ngTemplateOutlet=\"tabItem.titleTpl; context: tabItem\"></ng-container>\r\n      </ng-container>\r\n    </a>\r\n  </ng-container>\r\n  <ng-container *ngIf=\"tabItem.type === 'text'\">\r\n    <span class=\"text-item\">\r\n      <ng-container *ngIf=\"tabItem.titleStr\">\r\n        {{tabItem.titleStr}}\r\n      </ng-container>\r\n      <ng-container *ngIf=\"tabItem.titleTpl\">\r\n        <ng-container\r\n          *ngTemplateOutlet=\"tabItem.titleTpl; context: tabItem\"></ng-container>\r\n      </ng-container>\r\n    </span>\r\n  </ng-container>\r\n</ng-template>\r\n"
        }),
        tslib_1.__param(2, Optional()), tslib_1.__param(2, Inject(TAB_PANEL_RESOLVER)),
        tslib_1.__metadata("design:paramtypes", [Renderer2,
            ElementRef, Object])
    ], TabPanelComponent);
    return TabPanelComponent;
}());
export { TabPanelComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFiLXBhbmVsLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BpbnN0LWlvdC9ib3NjaC1hbmd1bGFyLXVpLWNvbXBvbmVudHMvIiwic291cmNlcyI6WyJtb2xlY3VsZXMvdGFiLXBhbmVsL3RhYi1wYW5lbC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFFTCxTQUFTLEVBQ1QsZUFBZSxFQUVmLFVBQVUsRUFDVixZQUFZLEVBQ1osWUFBWSxFQUNaLE1BQU0sRUFDTixjQUFjLEVBQUUsS0FBSyxFQUNyQixRQUFRLEVBQ1IsTUFBTSxFQUNOLFNBQVMsRUFDVCxTQUFTLEVBQ1QsU0FBUyxFQUNWLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBVW5FLE1BQU0sQ0FBQyxJQUFNLGtCQUFrQixHQUFHLElBQUksY0FBYyxDQUFtQixrQkFBa0IsQ0FBQyxDQUFDO0FBRTNGOzs7OztHQUtHO0FBS0g7SUFpQ0UsMkJBQW9CLFFBQW1CLEVBQ25CLE9BQW1CLEVBQ3FCLGdCQUFrQztRQUYxRSxhQUFRLEdBQVIsUUFBUSxDQUFXO1FBQ25CLFlBQU8sR0FBUCxPQUFPLENBQVk7UUFDcUIscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFrQjtRQWpDcEYsZUFBVSxHQUFHLElBQUksWUFBWSxFQUFVLENBQUM7UUFZbEQsYUFBUSxHQUE0QixFQUFFLENBQUM7UUFFdkM7Ozs7V0FJRztRQUVILGdCQUFXLEdBQUcsS0FBSyxDQUFDO1FBR3BCLHFCQUFnQixHQUFHLEtBQUssQ0FBQztRQU16QixlQUFVLEdBQUcsQ0FBQyxDQUFDO0lBS2YsQ0FBQztJQUd1QyxzQkFBSSw0Q0FBYTthQUFqQixVQUFrQixRQUEwQztZQUFwRyxpQkFvQkM7WUFuQkMsSUFBSSxDQUFDLFFBQVEsR0FBRyxRQUFRLENBQUMsT0FBTyxFQUFFLENBQUM7WUFDbkMsSUFBSSxJQUFJLENBQUMsVUFBVSxF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QUMsUUFBUSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxhQUFhLEVBQUUsUUFBUSxFQUFFLGNBQWMsR0FBRyxJQUFJLENBQUMsQ0FBQzthQUM5RjtTQUNGO0lBQ0gsQ0FBQztJQXpIUztRQUFULE1BQU0sRUFBRTs7eURBQXlDO0lBS3pDO1FBQVIsS0FBSyxFQUFFOztrREFBYTtJQUUwQjtRQUE5QyxTQUFTLENBQUMsa0JBQWtCLEVBQUUsRUFBQyxNQUFNLEVBQUUsSUFBSSxFQUFDLENBQUM7MENBQW1CLFVBQVU7K0RBQUM7SUFDckM7UUFBdEMsU0FBUyxDQUFDLFVBQVUsRUFBRSxFQUFDLE1BQU0sRUFBRSxJQUFJLEVBQUMsQ0FBQzswQ0FBVyxVQUFVO3VEQUFDO0lBWTVEO1FBREMsS0FBSyxFQUFFOzswREFDWTtJQUdwQjtRQURDLEtBQUssRUFBRTs7K0RBQ2lCO0lBY2U7UUFBdkMsZUFBZSxDQUFDLHFCQUFxQixDQUFDOzBDQUE2QixTQUFTO2lEQUFULFNBQVM7MERBb0I1RTtJQXdERDtRQURDLFlBQVksQ0FBQyxlQUFlLENBQUM7Ozs7cURBUzdCO0lBM0hVLGlCQUFpQjtRQUo3QixTQUFTLENBQUM7WUFDVCxRQUFRLEVBQUUsY0FBYztZQUN4QixnNkdBQXlDO1NBQzFDLENBQUM7UUFvQ2EsbUJBQUEsUUFBUSxFQUFFLENBQUEsRUFBRSxtQkFBQSxNQUFNLENBQUMsa0JBQWtCLENBQUMsQ0FBQTtpREFGckIsU0FBUztZQUNWLFVBQVU7T0FsQzVCLGlCQUFpQixDQTZIN0I7SUFBRCx3QkFBQztDQUFBLEFBN0hELElBNkhDO1NBN0hZLGlCQUFpQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgQWZ0ZXJWaWV3SW5pdCxcclxuICBDb21wb25lbnQsXHJcbiAgQ29udGVudENoaWxkcmVuLFxyXG4gIERvQ2hlY2ssXHJcbiAgRWxlbWVudFJlZixcclxuICBFdmVudEVtaXR0ZXIsXHJcbiAgSG9zdExpc3RlbmVyLFxyXG4gIEluamVjdCxcclxuICBJbmplY3Rpb25Ub2tlbiwgSW5wdXQsIE9uQ2hhbmdlcyxcclxuICBPcHRpb25hbCxcclxuICBPdXRwdXQsXHJcbiAgUXVlcnlMaXN0LFxyXG4gIFJlbmRlcmVyMiwgU2ltcGxlQ2hhbmdlcyxcclxuICBWaWV3Q2hpbGRcclxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgVGFiUGFuZWxJdGVtRGlyZWN0aXZlIH0gZnJvbSAnLi90YWItcGFuZWwtaXRlbS5kaXJlY3RpdmUnO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFRhYlBhbmVsUmVzb2x2ZXIge1xyXG4gIC8qKlxyXG4gICAqIFJlc29sdmVzIGEgdGFiIGJ5IGlkIGFuZCByZXR1cm5zIGFuIE9ic2VydmFibGUsIHRoYXQgZW1pdHMgdHJ1ZSwgd2hlbiBpdCB3YXMgZm91bmQuXHJcbiAgICovXHJcbiAgcmVzb2x2ZVRhYihpZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxib29sZWFuPjtcclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IFRBQl9QQU5FTF9SRVNPTFZFUiA9IG5ldyBJbmplY3Rpb25Ub2tlbjxUYWJQYW5lbFJlc29sdmVyPignVGFiUGFuZWxSZXNvbHZlcicpO1xyXG5cclxuLyoqXHJcbiAqIEEgdmVyeSBwb3dlcmZ1bCB0YWIgcGFuZWwgY29tcG9uZW50LlxyXG4gKiBJdCBjYW4gaGFuZGxlIGR5bmFtaWMgdGFicywgdGhlIHRhYiBiYXIgY2FuIGFjY2VwdCBhbGwga2luZCBvZiB0eXBlcy4gU2VlOiBUYWJQYW5lbEl0ZW1UeXBlXHJcbiAqIFdoZW4geW91IHByb3ZpZGUgYG91dGxldE5hbWVgLCB5b3Ugc2hvdWxkIHByb3ZpZGUgeW91ciByb3V0ZXIgY29uZmlnIHdpdGggc3VjaCBhbiBlbnRyeSB0byBlbmFibGUgdGhlIG91dGxldCByb3V0aW5nOlxyXG4gKiBjaGlsZHJlbjogW3twYXRoOiAnOmlkJywgb3V0bGV0OiAneW91ck91dGxldE5hbWUnLCBjb21wb25lbnQ6IFRhYlBhbmVsQ29tcG9uZW50fV1cclxuICovXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAncmItdGFiLXBhbmVsJyxcclxuICB0ZW1wbGF0ZVVybDogJy4vdGFiLXBhbmVsLmNvbXBvbmVudC5odG1sJ1xyXG59KVxyXG5leHBvcnQgY2xhc3MgVGFiUGFuZWxDb21wb25lbnQgaW1wbGVtZW50cyBBZnRlclZpZXdJbml0LCBEb0NoZWNrLCBPbkNoYW5nZXMge1xyXG5cclxuICBAT3V0cHV0KCkgdGFiQ2hhbmdlZCA9IG5ldyBFdmVudEVtaXR0ZXI8c3RyaW5nPigpO1xyXG5cclxuICAvKipcclxuICAgKiBjaGFuZ2UgdGhpcyBpbnB1dCB0byBhbiB0YWIgaWQgdG8gb3BlbiB0aGF0IHRhYi5cclxuICAgKi9cclxuICBASW5wdXQoKSB0YWI6IHN0cmluZztcclxuXHJcbiAgQFZpZXdDaGlsZCgncGFuZWxQbGFjZWhvbGRlcicsIHtzdGF0aWM6IHRydWV9KSBwYW5lbFBsYWNlaG9sZGVyOiBFbGVtZW50UmVmO1xyXG4gIEBWaWV3Q2hpbGQoJ3RhYlBhbmVsJywge3N0YXRpYzogdHJ1ZX0pIHRhYlBhbmVsOiBFbGVtZW50UmVmO1xyXG5cclxuICBvdXRsZXROYW1lOiBzdHJpbmc7XHJcblxyXG4gIHRhYkl0ZW1zOiBUYWJQYW5lbEl0ZW1EaXJlY3RpdmVbXSA9IFtdO1xyXG5cclxuICAvKipcclxuICAgKiBXaGV0aGVyIHRhYnMgdGhhdCB3ZXJlIG9wZW5lZCBvbmNlLCBzaG91bGQgYmUga2VwdCBpbiB0aGUgRE9NXHJcbiAgICogd2hlbiBzd2l0Y2hpbmcgYXdheSBmcm9tIHRoZW0uIE9yIHNob3VsZCB0aGV5IGJlIHJlbW92ZWQgZnJvbVxyXG4gICAqIERPTSB3aGVuIHN3aXRjaGVkIHRvIGFub3RoZXIgdGFiP1xyXG4gICAqL1xyXG4gIEBJbnB1dCgpXHJcbiAgZGVzdHJveVRhYnMgPSBmYWxzZTtcclxuXHJcbiAgQElucHV0KClcclxuICByZW5kZXJIaWRkZW5UYWJzID0gZmFsc2U7XHJcblxyXG4gIHRhYkl0ZW1zTGVmdDogVGFiUGFuZWxJdGVtRGlyZWN0aXZlW107XHJcbiAgdGFiSXRlbXNDZW50ZXI6IFRhYlBhbmVsSXRlbURpcmVjdGl2ZVtdO1xyXG4gIHRhYkl0ZW1zUmlnaHQ6IFRhYlBhbmVsSXRlbURpcmVjdGl2ZVtdO1xyXG5cclxuICBsYXN0SGVpZ2h0ID0gMDtcclxuXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSByZW5kZXJlcjogUmVuZGVyZXIyLFxyXG4gICAgICAgICAgICAgIHByaXZhdGUgZWxlbWVudDogRWxlbWVudFJlZixcclxuICAgICAgICAgICAgICBAT3B0aW9uYWwoKSBASW5qZWN0KFRBQl9QQU5FTF9SRVNPTFZFUikgcHJpdmF0ZSB0YWJQYW5lbFJlc29sdmVyOiBUYWJQYW5lbFJlc29sdmVyKSB7XHJcbiAgfVxyXG5cclxuXHJcbiAgQENvbnRlbnRDaGlsZHJlbihUYWJQYW5lbEl0ZW1EaXJlY3RpdmUpIHNldCB0YWJJdGVtc1F1ZXJ5KHRhYkl0ZW1zOiBRdWVyeUxpc3Q8VGFiUGFuZWxJdGVtRGlyZWN0aXZlPikge1xyXG4gICAgdGhpcy50YWJJdGVtcyA9IHRhYkl0ZW1zLnRvQXJyYXkoKTtcclxuICAgIGlmICh0aGlzLm91dGxldE5hbWUpIHtcclxuICAgICAgdGhpcy50YWJJdGVtcy5mb3JFYWNoKHRhYkl0ZW0gPT4ge1xyXG4gICAgICAgIGNvbnN0IGxpbmsgPSB7b3V0bGV0czoge319O1xyXG4gICAgICAgIGxpbmsub3V0bGV0c1t0aGlzLm91dGxldE5hbWVdID0gW3RhYkl0ZW0uaWRdO1xyXG4gICAgICAgIHRhYkl0ZW0ucm91dGVyTGluayA9IFtsaW5rXTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRoaXMudGFiSXRlbXMubGVuZ3RoICYmIHRoaXMudGFiSXRlbXMuZXZlcnkodGFiSXRlbSA9PiAhdGFiSXRlbS5hY3RpdmUpKSB7XHJcbiAgICAgIGlmICh0aGlzLnRhYikge1xyXG4gICAgICAgIHRoaXMuc2hvd1RhYih0aGlzLnRhYik7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5zaG93Rmlyc3RUYWIoKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgdGhpcy50YWJJdGVtc0xlZnQgPSB0aGlzLnRhYkl0ZW1zLmZpbHRlcih0YWJJdGVtID0+IHRhYkl0ZW0ucG9zaXRpb24gPT09ICdsZWZ0Jyk7XHJcbiAgICB0aGlzLnRhYkl0ZW1zQ2VudGVyID0gdGhpcy50YWJJdGVtcy5maWx0ZXIodGFiSXRlbSA9PiB0YWJJdGVtLnBvc2l0aW9uID09PSAnY2VudGVyJyk7XHJcbiAgICB0aGlzLnRhYkl0ZW1zUmlnaHQgPSB0aGlzLnRhYkl0ZW1zLmZpbHRlcih0YWJJdGVtID0+IHRhYkl0ZW0ucG9zaXRpb24gPT09ICdyaWdodCcpO1xyXG4gIH1cclxuXHJcblxyXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcclxuICAgIHRoaXMub25SZXNpemUoKTtcclxuICB9XHJcblxyXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpOiB2b2lkIHtcclxuICAgIGlmIChjaGFuZ2VzLnRhYiAmJiBjaGFuZ2VzLnRhYi5jdXJyZW50VmFsdWUgJiYgIWNoYW5nZXMudGFiLmZpcnN0Q2hhbmdlKSB7XHJcbiAgICAgIGNvbnN0IGZvdW5kID0gdGhpcy50YWJJdGVtcy5maW5kKHRhYkl0ZW0gPT4gdGFiSXRlbS5pZCA9PT0gY2hhbmdlcy50YWIuY3VycmVudFZhbHVlKTtcclxuICAgICAgaWYgKGZvdW5kICYmICFmb3VuZC5hY3RpdmUpIHtcclxuICAgICAgICB0aGlzLnNob3dUYWIoY2hhbmdlcy50YWIuY3VycmVudFZhbHVlKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgbmdEb0NoZWNrKCkge1xyXG4gICAgaWYgKHRoaXMuZWxlbWVudCAmJiB0aGlzLmVsZW1lbnQubmF0aXZlRWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoJ2Z1bGwtd2lkdGgnKSkge1xyXG4gICAgICB0aGlzLm9uUmVzaXplKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc2hvd0ZpcnN0VGFiKCkge1xyXG4gICAgY29uc3QgZmlyc3RJdGVtID0gdGhpcy50YWJJdGVtcy5maW5kKHRhYkl0ZW0gPT4gdGFiSXRlbS50eXBlID09PSAndGFiJyk7XHJcbiAgICBpZiAoZmlyc3RJdGVtKSB7XHJcbiAgICAgIHRoaXMuc2hvd1RhYihmaXJzdEl0ZW0uaWQpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ2FuIGJlIHVzZWQgdG8gc2hvdyBhIGNlcnRhaW4gdGFiLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBzaG93VGFiKGlkOiBzdHJpbmcpIHtcclxuICAgIGNvbnN0IGZvdW5kID0gdGhpcy50YWJJdGVtcy5maW5kKHRhYkl0ZW0gPT4gdGFiSXRlbS5pZCA9PT0gaWQpO1xyXG4gICAgaWYgKCFmb3VuZCkge1xyXG4gICAgICAvLyB3YWl0IGEgdGlja1xyXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICB0aGlzLmRlYWN0aXZhdGVBbmRTaG93VGFiKGlkKTtcclxuICAgICAgfSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLmRlYWN0aXZhdGVBbmRTaG93VGFiKGlkKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgZGVhY3RpdmF0ZUFuZFNob3dUYWIoaWQ6IHN0cmluZykge1xyXG4gICAgdGhpcy50YWJJdGVtcy5mb3JFYWNoKHRhYkl0ZW0gPT4ge1xyXG4gICAgICBpZiAodGFiSXRlbS5hY3RpdmUgJiYgdGFiSXRlbS5pZCAhPT0gaWQpIHtcclxuICAgICAgICB0YWJJdGVtLmhpZGUoKTtcclxuICAgICAgfSBlbHNlIGlmICh0YWJJdGVtLmlkID09PSBpZCkge1xyXG4gICAgICAgIHRhYkl0ZW0uc2hvdygpO1xyXG4gICAgICAgIHRoaXMudGFiQ2hhbmdlZC5uZXh0KGlkKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBASG9zdExpc3RlbmVyKCd3aW5kb3c6cmVzaXplJylcclxuICBvblJlc2l6ZSgpIHtcclxuICAgIGlmICh0aGlzLnBhbmVsUGxhY2Vob2xkZXIgJiYgdGhpcy50YWJQYW5lbCkge1xyXG4gICAgICBjb25zdCB0YWJQYW5lbEhlaWdodCA9IHRoaXMudGFiUGFuZWwubmF0aXZlRWxlbWVudC5vZmZzZXRIZWlnaHQ7XHJcbiAgICAgIGlmIChNYXRoLmFicyh0aGlzLmxhc3RIZWlnaHQgLSB0YWJQYW5lbEhlaWdodCkgPiAyKSB7XHJcbiAgICAgICAgdGhpcy5sYXN0SGVpZ2h0ID0gdGFiUGFuZWxIZWlnaHQ7XHJcbiAgICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLnBhbmVsUGxhY2Vob2xkZXIubmF0aXZlRWxlbWVudCwgJ2hlaWdodCcsIHRhYlBhbmVsSGVpZ2h0ICsgJ3B4Jyk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG59XHJcbiJdfQ==