import * as tslib_1 from "tslib";
import { ComponentFactoryResolver, Directive, HostListener, Input, TemplateRef, ViewContainerRef } from '@angular/core';
import { DropdownComponent } from './dropdown.component';
let DropdownDirective = class DropdownDirective {
    constructor(factoryResolver, viewContainerRef) {
        this.factoryResolver = factoryResolver;
        this.viewContainerRef = viewContainerRef;
        this.position = 'left';
        this.autoClose = true;
        this.renderOnInit = false;
        this.hugContent = false;
        this.openOnClick = true;
        this.componentRef = null;
        this.closeSub = null;
    }
    ngOnDestroy() {
        this.closeDropdown();
    }
    ngOnInit() {
        if (this.renderOnInit) {
            this.renderDropdown();
        }
    }
    set template(tpl) {
        this.tpl = tpl;
    }
    onClick(e) {
        if (!this.openOnClick) {
            return;
        }
        e.preventDefault();
        this.openDropdown();
    }
    set context(ctx) {
        this._context = ctx;
        if (this.componentRef) {
            this.componentRef.instance.updateContext(ctx);
        }
    }
    renderDropdown() {
        const componentFactory = this.factoryResolver.resolveComponentFactory(DropdownComponent);
        this.componentRef = this.viewContainerRef.createComponent(componentFactory);
        this.componentRef.instance.anchor = this.viewContainerRef.element;
        this.componentRef.instance.content = this.tpl;
        this.componentRef.instance.primaryPos = this.position;
        this.componentRef.instance.autoClose = this.autoClose;
        this.componentRef.instance.hugContent = this.hugContent;
        this.closeSub = this.componentRef.instance.close.subscribe(() => {
            this.closeDropdown();
        });
        if (this._context) {
            this.componentRef.instance.updateContext(this._context);
        }
    }
    openDropdown() {
        if (this.componentRef && !this.renderOnInit || this.renderOnInit && this.componentRef.instance.shown) {
            this.closeDropdown();
            return;
        }
        if (!this.renderOnInit) {
            this.renderDropdown();
        }
        this.componentRef.instance.show();
        this.viewContainerRef.element.nativeElement.classList.add('open');
    }
    closeDropdown() {
        if (this.componentRef) {
            this.componentRef.instance.hide();
            this.viewContainerRef.element.nativeElement.classList.remove('open');
            if (!this.renderOnInit) {
                if (this.closeSub) {
                    this.closeSub.unsubscribe();
                }
                const viewIndex = this.viewContainerRef.indexOf(this.componentRef.hostView);
                if (viewIndex !== -1) {
                    this.viewContainerRef.remove(viewIndex);
                }
                this.componentRef = null;
            }
        }
    }
};
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", String)
], DropdownDirective.prototype, "position", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", Object)
], DropdownDirective.prototype, "autoClose", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", Object)
], DropdownDirective.prototype, "renderOnInit", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", Object)
], DropdownDirective.prototype, "hugContent", void 0);
tslib_1.__decorate([
    Input('rbDropdown'),
    tslib_1.__metadata("design:type", TemplateRef),
    tslib_1.__metadata("design:paramtypes", [TemplateRef])
], DropdownDirective.prototype, "template", null);
tslib_1.__decorate([
    HostListener('click', ['$event']),
    tslib_1.__metadata("design:type", Function),
    tslib_1.__metadata("design:paramtypes", [MouseEvent]),
    tslib_1.__metadata("design:returntype", void 0)
], DropdownDirective.prototype, "onClick", null);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", Object),
    tslib_1.__metadata("design:paramtypes", [Object])
], DropdownDirective.prototype, "context", null);
DropdownDirective = tslib_1.__decorate([
    Directive({
        selector: '[rbDropdown]',
        exportAs: 'rbDropdown'
    }),
    tslib_1.__metadata("design:paramtypes", [ComponentFactoryResolver,
        ViewContainerRef])
], DropdownDirective);
export { DropdownDirective };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJvcGRvd24uZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGluc3QtaW90L2Jvc2NoLWFuZ3VsYXItdWktY29tcG9uZW50cy8iLCJzb3VyY2VzIjpbImF0b21zL2Ryb3Bkb3duL2Ryb3Bkb3duLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUNMLHdCQUF3QixFQUV4QixTQUFTLEVBQ1QsWUFBWSxFQUNaLEtBQUssRUFHTCxXQUFXLEVBQ1gsZ0JBQWdCLEVBQ2pCLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBTXpELElBQWEsaUJBQWlCLEdBQTlCLE1BQWEsaUJBQWlCO0lBb0I1QixZQUFvQixlQUF5QyxFQUN6QyxnQkFBa0M7UUFEbEMsb0JBQWUsR0FBZixlQUFlLENBQTBCO1FBQ3pDLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7UUFuQjdDLGFBQVEsR0FBZ0MsTUFBTSxDQUFDO1FBRS9DLGNBQVMsR0FBRyxJQUFJLENBQUM7UUFFakIsaUJBQVksR0FBRyxLQUFLLENBQUM7UUFFckIsZUFBVSxHQUFHLEtBQUssQ0FBQztRQUk1QixnQkFBVyxHQUFHLElBQUksQ0FBQztRQUluQixpQkFBWSxHQUFvQyxJQUFJLENBQUM7UUFFckQsYUFBUSxHQUFHLElBQUksQ0FBQztJQUloQixDQUFDO0lBR0QsV0FBVztRQUNULElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztJQUN2QixDQUFDO0lBR0QsUUFBUTtRQUNOLElBQUksSUFBSSxDQUFDLFlBQVksRUFBRTtZQUNyQixJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7U0FDdkI7SUFDSCxDQUFDO0lBRW9CLElBQUksUUFBUSxDQUFDLEdBQXFCO1FBQ3JELElBQUksQ0FBQyxHQUFHLEdBQUcsR0FBRyxDQUFDO0lBQ2pCLENBQUM7SUFHRCxPQUFPLENBQUMsQ0FBYTtRQUNuQixJQUFJLENBQUMsSUFBSSxD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QUFJLFNBQVMsS0FBSyxDQUFDLENBQUMsRUFBRTtvQkFDcEIsSUFBSSxDQUFDLGdCQUFnQixDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQztpQkFDekM7Z0JBQ0QsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUM7YUFDMUI7U0FDRjtJQUNILENBQUM7Q0FFRixDQUFBO0FBeEdVO0lBQVIsS0FBSyxFQUFFOzttREFBZ0Q7QUFFL0M7SUFBUixLQUFLLEVBQUU7O29EQUFrQjtBQUVqQjtJQUFSLEtBQUssRUFBRTs7dURBQXNCO0FBRXJCO0lBQVIsS0FBSyxFQUFFOztxREFBb0I7QUE0QlA7SUFBcEIsS0FBSyxDQUFDLFlBQVksQ0FBQztzQ0FBbUIsV0FBVzs2Q0FBWCxXQUFXO2lEQUVqRDtBQUdEO0lBREMsWUFBWSxDQUFDLE9BQU8sRUFBRSxDQUFDLFFBQVEsQ0FBQyxDQUFDOzs2Q0FDdkIsVUFBVTs7Z0RBTXBCO0FBRVE7SUFBUixLQUFLLEVBQUU7OztnREFLUDtBQXREVSxpQkFBaUI7SUFKN0IsU0FBUyxDQUFDO1FBQ1QsUUFBUSxFQUFFLGNBQWM7UUFDeEIsUUFBUSxFQUFFLFlBQVk7S0FDdkIsQ0FBQzs2Q0FxQnFDLHdCQUF3QjtRQUN2QixnQkFBZ0I7R0FyQjNDLGlCQUFpQixDQTBHN0I7U0ExR1ksaUJBQWlCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsXHJcbiAgQ29tcG9uZW50UmVmLFxyXG4gIERpcmVjdGl2ZSxcclxuICBIb3N0TGlzdGVuZXIsXHJcbiAgSW5wdXQsXHJcbiAgT25EZXN0cm95LFxyXG4gIE9uSW5pdCxcclxuICBUZW1wbGF0ZVJlZixcclxuICBWaWV3Q29udGFpbmVyUmVmXHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IERyb3Bkb3duQ29tcG9uZW50IH0gZnJvbSAnLi9kcm9wZG93bi5jb21wb25lbnQnO1xyXG5cclxuQERpcmVjdGl2ZSh7XHJcbiAgc2VsZWN0b3I6ICdbcmJEcm9wZG93bl0nLFxyXG4gIGV4cG9ydEFzOiAncmJEcm9wZG93bidcclxufSlcclxuZXhwb3J0IGNsYXNzIERyb3Bkb3duRGlyZWN0aXZlIGltcGxlbWVudHMgT25EZXN0cm95LCBPbkluaXQge1xyXG5cclxuICBASW5wdXQoKSBwb3NpdGlvbjogJ2xlZnQnIHwgJ3JpZ2h0JyB8ICdjZW50ZXInID0gJ2xlZnQnO1xyXG5cclxuICBASW5wdXQoKSBhdXRvQ2xvc2UgPSB0cnVlO1xyXG5cclxuICBASW5wdXQoKSByZW5kZXJPbkluaXQgPSBmYWxzZTtcclxuXHJcbiAgQElucHV0KCkgaHVnQ29udGVudCA9IGZhbHNlO1xyXG5cclxuICBwcml2YXRlIF9jb250ZXh0OiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xyXG5cclxuICBvcGVuT25DbGljayA9IHRydWU7XHJcblxyXG4gIHRwbDogVGVtcGxhdGVSZWY8YW55PjtcclxuXHJcbiAgY29tcG9uZW50UmVmOiBDb21wb25lbnRSZWY8RHJvcGRvd25Db21wb25lbnQ+ID0gbnVsbDtcclxuXHJcbiAgY2xvc2VTdWIgPSBudWxsO1xyXG5cclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGZhY3RvcnlSZXNvbHZlcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxyXG4gICAgICAgICAgICAgIHByaXZhdGUgdmlld0NvbnRhaW5lclJlZjogVmlld0NvbnRhaW5lclJlZikge1xyXG4gIH1cclxuXHJcblxyXG4gIG5nT25EZXN0cm95KCkge1xyXG4gICAgdGhpcy5jbG9zZURyb3Bkb3duKCk7XHJcbiAgfVxyXG5cclxuXHJcbiAgbmdPbkluaXQoKTogdm9pZCB7XHJcbiAgICBpZiAodGhpcy5yZW5kZXJPbkluaXQpIHtcclxuICAgICAgdGhpcy5yZW5kZXJEcm9wZG93bigpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgQElucHV0KCdyYkRyb3Bkb3duJykgc2V0IHRlbXBsYXRlKHRwbDogVGVtcGxhdGVSZWY8YW55Pikge1xyXG4gICAgdGhpcy50cGwgPSB0cGw7XHJcbiAgfVxyXG5cclxuICBASG9zdExpc3RlbmVyKCdjbGljaycsIFsnJGV2ZW50J10pXHJcbiAgb25DbGljayhlOiBNb3VzZUV2ZW50KSB7XHJcbiAgICBpZiAoIXRoaXMub3Blbk9uQ2xpY2spIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgdGhpcy5vcGVuRHJvcGRvd24oKTtcclxuICB9XHJcblxyXG4gIEBJbnB1dCgpIHNldCBjb250ZXh0KGN0eDogUmVjb3JkPHN0cmluZywgYW55Pikge1xyXG4gICAgdGhpcy5fY29udGV4dCA9IGN0eDtcclxuICAgIGlmICh0aGlzLmNvbXBvbmVudFJlZikge1xyXG4gICAgICB0aGlzLmNvbXBvbmVudFJlZi5pbnN0YW5jZS51cGRhdGVDb250ZXh0KGN0eCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICByZW5kZXJEcm9wZG93bigpIHtcclxuICAgIGNvbnN0IGNvbXBvbmVudEZhY3RvcnkgPSB0aGlzLmZhY3RvcnlSZXNvbHZlci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShEcm9wZG93bkNvbXBvbmVudCk7XHJcbiAgICB0aGlzLmNvbXBvbmVudFJlZiA9IHRoaXMudmlld0NvbnRhaW5lclJlZi5jcmVhdGVDb21wb25lbnQoY29tcG9uZW50RmFjdG9yeSk7XHJcbiAgICB0aGlzLmNvbXBvbmVudFJlZi5pbnN0YW5jZS5hbmNob3IgPSB0aGlzLnZpZXdDb250YWluZXJSZWYuZWxlbWVudDtcclxuICAgIHRoaXMuY29tcG9uZW50UmVmLmluc3RhbmNlLmNvbnRlbnQgPSB0aGlzLnRwbDtcclxuICAgIHRoaXMuY29tcG9uZW50UmVmLmluc3RhbmNlLnByaW1hcnlQb3MgPSB0aGlzLnBvc2l0aW9uO1xyXG4gICAgdGhpcy5jb21wb25lbnRSZWYuaW5zdGFuY2UuYXV0b0Nsb3NlID0gdGhpcy5hdXRvQ2xvc2U7XHJcbiAgICB0aGlzLmNvbXBvbmVudFJlZi5pbnN0YW5jZS5odWdDb250ZW50ID0gdGhpcy5odWdDb250ZW50O1xyXG4gICAgdGhpcy5jbG9zZVN1YiA9IHRoaXMuY29tcG9uZW50UmVmLmluc3RhbmNlLmNsb3NlLnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgIHRoaXMuY2xvc2VEcm9wZG93bigpO1xyXG4gICAgfSk7XHJcbiAgICBpZiAodGhpcy5fY29udGV4dCkge1xyXG4gICAgICB0aGlzLmNvbXBvbmVudFJlZi5pbnN0YW5jZS51cGRhdGVDb250ZXh0KHRoaXMuX2NvbnRleHQpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgb3BlbkRyb3Bkb3duKCkge1xyXG4gICAgaWYgKHRoaXMuY29tcG9uZW50UmVmICYmICF0aGlzLnJlbmRlck9uSW5pdCB8fCB0aGlzLnJlbmRlck9uSW5pdCAmJiB0aGlzLmNvbXBvbmVudFJlZi5pbnN0YW5jZS5zaG93bikge1xyXG4gICAgICB0aGlzLmNsb3NlRHJvcGRvd24oKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICghdGhpcy5yZW5kZXJPbkluaXQpIHtcclxuICAgICAgdGhpcy5yZW5kZXJEcm9wZG93bigpO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuY29tcG9uZW50UmVmLmluc3RhbmNlLnNob3coKTtcclxuICAgIHRoaXMudmlld0NvbnRhaW5lclJlZi5lbGVtZW50Lm5hdGl2ZUVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnb3BlbicpO1xyXG5cclxuICB9XHJcblxyXG4gIGNsb3NlRHJvcGRvd24oKSB7XHJcbiAgICBpZiAodGhpcy5jb21wb25lbnRSZWYpIHtcclxuXHJcbiAgICAgIHRoaXMuY29tcG9uZW50UmVmLmluc3RhbmNlLmhpZGUoKTtcclxuICAgICAgdGhpcy52aWV3Q29udGFpbmVyUmVmLmVsZW1lbnQubmF0aXZlRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdvcGVuJyk7XHJcblxyXG4gICAgICBpZiAoIXRoaXMucmVuZGVyT25Jbml0KSB7XHJcbiAgICAgICAgaWYgKHRoaXMuY2xvc2VTdWIpIHtcclxuICAgICAgICAgIHRoaXMuY2xvc2VTdWIudW5zdWJzY3JpYmUoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3Qgdmlld0luZGV4ID0gdGhpcy52aWV3Q29udGFpbmVyUmVmLmluZGV4T2YodGhpcy5jb21wb25lbnRSZWYuaG9zdFZpZXcpO1xyXG4gICAgICAgIGlmICh2aWV3SW5kZXggIT09IC0xKSB7XHJcbiAgICAgICAgICB0aGlzLnZpZXdDb250YWluZXJSZWYucmVtb3ZlKHZpZXdJbmRleCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuY29tcG9uZW50UmVmID0gbnVsbDtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbn1cclxuIl19