import * as tslib_1 from "tslib";
var FormCustomSelectComponent_1;
import { Component, ContentChild, ContentChildren, ElementRef, forwardRef, HostListener, Inject, Input, QueryList, Renderer2, TemplateRef, ViewChild } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { FormValidationMessageDirective } from '../form-validation-message.directive';
import { emptyFunction } from '../forms-util';
import { MultiSelectOptionDirective, MultiSelectTitleDirective } from '../form-multi-select/form-multi-select.component';
import { Subject } from 'rxjs';
import { FORM_SELECT_SELECTOR } from './form-custom-select.model';
import { FormSelectOptionComponent } from './form-select-option/form-select-option.component';
export function customSelectSelectorFactory() {
    return new Subject();
}
/**
 * This component offers a select field, that can be heavily customized.
 * The easy way would to just add options like this:
 * <rb-form-select-option [value]=""></rb-form-select-option>
 *
 * But you can also provide a selectionTpl which is a ng-template that is used to show the options in the dropdown.
 * It gets a context, that contains a select() function that can be used to provide the value for the ngModel.
 */
let FormCustomSelectComponent = FormCustomSelectComponent_1 = class FormCustomSelectComponent {
    constructor(renderer, elementRef, selectSubject) {
        this.renderer = renderer;
        this.elementRef = elementRef;
        this.selectSubject = selectSubject;
        this.label = null;
        this.id = 'customSelectValue.' + Math.random();
        this.selectionTpl = null;
        this.autoClose = true;
        this.isMouseOver = false;
        this.onChange = emptyFunction;
        this.onTouched = emptyFunction;
        this.value = null;
        this.updateValue = value => {
            this.value = value;
            this.onChange(value);
            this.checkValue(value);
        };
    }
    ngOnInit() {
        this.selectSub = this.selectSubject.subscribe(action => {
            if (action.type === 'update') {
                this.updateValue(action.value);
            }
        });
    }
    ngOnDestroy() {
        if (this.selectSub) {
            this.selectSub.unsubscribe();
        }
    }
    ngAfterViewInit() {
        this.updateCurrentLabel(this.value);
    }
    isLabelTemplate() {
        return this.label instanceof TemplateRef;
    }
    mouseover() {
        this.isMouseOver = true;
    }
    mouseleave() {
        this.isMouseOver = false;
    }
    writeValue(value) {
        this.value = value;
        this.selectSubject.next({ type: 'write', value });
        this.checkValue(value);
    }
    registerOnChange(fn) {
        this.onChange = fn;
    }
    registerOnTouched(fn) {
        this.onTouched = fn;
    }
    setDisabledState(isDisabled) {
        this.disabled = isDisabled;
    }
    checkValue(value) {
        if (typeof (value) === 'string' && value.length > 0 || typeof (value) === 'number' || typeof (value) === 'boolean' || value) {
            this.renderer.addClass(this.elementRef.nativeElement, 'not-empty');
        }
        else {
            this.renderer.removeClass(this.elementRef.nativeElement, 'not-empty');
        }
        this.updateCurrentLabel(value);
    }
    updateCurrentLabel(value) {
        if (this.options && this.options.length) {
            const opt = this.options.find(item => item.value === value);
            if (opt) {
                this.activeElement.nativeElement.innerHTML = opt.content.nativeElement.innerHTML;
            }
        }
    }
};
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", String)
], FormCustomSelectComponent.prototype, "name", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", Object)
], FormCustomSelectComponent.prototype, "label", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", TemplateRef)
], FormCustomSelectComponent.prototype, "selectionTpl", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", Object)
], FormCustomSelectComponent.prototype, "autoClose", void 0);
tslib_1.__decorate([
    ContentChildren(FormValidationMessageDirective),
    tslib_1.__metadata("design:type", QueryList)
], FormCustomSelectComponent.prototype, "messages", void 0);
tslib_1.__decorate([
    ContentChild(MultiSelectOptionDirective, { static: false }),
    tslib_1.__metadata("design:type", MultiSelectOptionDirective)
], FormCustomSelectComponent.prototype, "option", void 0);
tslib_1.__decorate([
    ContentChild(MultiSelectTitleDirective, { static: false }),
    tslib_1.__metadata("design:type", MultiSelectTitleDirective)
], FormCustomSelectComponent.prototype, "title", void 0);
tslib_1.__decorate([
    ContentChildren(FormSelectOptionComponent),
    tslib_1.__metadata("design:type", QueryList)
], FormCustomSelectComponent.prototype, "options", void 0);
tslib_1.__decorate([
    ViewChild('activeElement', { static: true }),
    tslib_1.__metadata("design:type", ElementRef)
], FormCustomSelectComponent.prototype, "activeElement", void 0);
tslib_1.__decorate([
    HostListener('mouseenter'),
    tslib_1.__metadata("design:type", Function),
    tslib_1.__metadata("design:paramtypes", []),
    tslib_1.__metadata("design:returntype", void 0)
], FormCustomSelectComponent.prototype, "mouseover", null);
tslib_1.__decorate([
    HostListener('mouseleave'),
    tslib_1.__metadata("design:type", Function),
    tslib_1.__metadata("design:paramtypes", []),
    tslib_1.__metadata("design:returntype", void 0)
], FormCustomSelectComponent.prototype, "mouseleave", null);
FormCustomSelectComponent = FormCustomSelectComponent_1 = tslib_1.__decorate([
    Component({
        selector: 'rb-form-custom-select',
        template: "<div class=\"input-wrapper\" [class.no-label]=\"!label\">\r\n\r\n  <button [rbDropdown]=\"dropdownContent\"\r\n          [id]=\"id\"\r\n          [autoClose]=\"autoClose\"\r\n          [disabled]=\"disabled !== undefined\"\r\n          (blur)=\"onTouched()\"\r\n          class=\"rb-select-btn input\">\r\n    <ng-container *ngIf=\"!options.length\">\r\n      <ng-container *ngTemplateOutlet=\"content\"></ng-container>\r\n    </ng-container>\r\n    <span #activeElement></span>\r\n  </button>\r\n\r\n  <label [for]=\"id\" class=\"label rb-select-label\">\r\n    {{!isLabelTemplate() ? label : ''}}\r\n    <ng-container *ngIf=\"isLabelTemplate()\">\r\n      <ng-container *ngTemplateOutlet=\"label\"></ng-container>\r\n    </ng-container>\r\n  </label>\r\n  <span class=\"select-icon rb-ic rb-ic-down\"></span>\r\n  <span class=\"input-background\"></span>\r\n</div>\r\n<rb-form-errors [messages]=\"messages\"></rb-form-errors>\r\n\r\n<ng-template #content>\r\n  <ng-content></ng-content>\r\n</ng-template>\r\n\r\n<ng-template #dropdownContent let-close=\"close\">\r\n  <ng-container *ngIf=\"options.length\">\r\n    <ng-container *ngTemplateOutlet=\"content\"></ng-container>\r\n  </ng-container>\r\n  <ng-container *ngTemplateOutlet=\"selectionTpl; context: {select: updateValue, close: close}\"></ng-container>\r\n</ng-template>\r\n",
        providers: [
            { provide: NG_VALUE_ACCESSOR, useExisting: forwardRef(() => FormCustomSelectComponent_1), multi: true },
            { provide: FORM_SELECT_SELECTOR, useFactory: customSelectSelectorFactory }
        ]
    }),
    tslib_1.__param(2, Inject(FORM_SELECT_SELECTOR)),
    tslib_1.__metadata("design:paramtypes", [Renderer2,
        ElementRef,
        Subject])
], FormCustomSelectComponent);
export { FormCustomSelectComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9ybS1jdXN0b20tc2VsZWN0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BpbnN0LWlvdC9ib3NjaC1hbmd1bGFyLXVpLWNvbXBvbmVudHMvIiwic291cmNlcyI6WyJhdG9tcy9mb3JtLWZpZWxkcy9mb3JtLWN1c3RvbS1zZWxlY3QvZm9ybS1jdXN0b20tc2VsZWN0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLE9BQU8sRUFFTCxTQUFTLEVBQ1QsWUFBWSxFQUNaLGVBQWUsRUFDZixVQUFVLEVBQ1YsVUFBVSxFQUNWLFlBQVksRUFDWixNQUFNLEVBQ04sS0FBSyxFQUdMLFNBQVMsRUFDVCxTQUFTLEVBQ1QsV0FBVyxFQUNYLFNBQVMsRUFDVixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQXdCLGlCQUFpQixFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDekUsT0FBTyxFQUFFLDhCQUE4QixFQUFFLE1BQU0sc0NBQXNDLENBQUM7QUFDdEYsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUM5QyxPQUFPLEVBQUUsMEJBQTBCLEVBQUUseUJBQXlCLEVBQUUsTUFBTSxrREFBa0QsQ0FBQztBQUN6SCxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQy9CLE9BQU8sRUFBRSxvQkFBb0IsRUFBb0IsTUFBTSw0QkFBNEIsQ0FBQztBQUNwRixPQUFPLEVBQUUseUJBQXlCLEVBQUUsTUFBTSxtREFBbUQsQ0FBQztBQUU5RixNQUFNLFVBQVUsMkJBQTJCO0lBQ3pDLE9BQU8sSUFBSSxPQUFPLEVBQW9CLENBQUM7QUFDekMsQ0FBQztBQUVEOzs7Ozs7O0dBT0c7QUFTSCxJQUFhLHlCQUF5QixpQ0FBdEMsTUFBYSx5QkFBeUI7SUE4QnBDLFlBQW9CLFFBQW1CLEVBQ25CLFVBQXNCLEVBQ1EsYUFBd0M7UUFGdEUsYUFBUSxHQUFSLFFBQVEsQ0FBVztRQUNuQixlQUFVLEdBQVYsVUFBVSxD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O0FBcEVVLHlCQUF5QjtJQVJyQyxTQUFTLENBQUM7UUFDVCxRQUFRLEVBQUUsdUJBQXVCO1FBQ2pDLG0wQ0FBa0Q7UUFDbEQsU0FBUyxFQUFFO1lBQ1QsRUFBQyxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsV0FBVyxFQUFFLFVBQVUsQ0FBQyxHQUFHLEVBQUUsQ0FBQywyQkFBeUIsQ0FBQyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUM7WUFDbkcsRUFBQyxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsVUFBVSxFQUFFLDJCQUEyQixFQUFDO1NBQ3pFO0tBQ0YsQ0FBQztJQWlDYSxtQkFBQSxNQUFNLENBQUMsb0JBQW9CLENBQUMsQ0FBQTs2Q0FGWCxTQUFTO1FBQ1AsVUFBVTtRQUN1QixPQUFPO0dBaEM3RCx5QkFBeUIsQ0E2R3JDO1NBN0dZLHlCQUF5QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgQWZ0ZXJWaWV3SW5pdCxcclxuICBDb21wb25lbnQsXHJcbiAgQ29udGVudENoaWxkLFxyXG4gIENvbnRlbnRDaGlsZHJlbixcclxuICBFbGVtZW50UmVmLFxyXG4gIGZvcndhcmRSZWYsXHJcbiAgSG9zdExpc3RlbmVyLFxyXG4gIEluamVjdCxcclxuICBJbnB1dCxcclxuICBPbkRlc3Ryb3ksXHJcbiAgT25Jbml0LFxyXG4gIFF1ZXJ5TGlzdCxcclxuICBSZW5kZXJlcjIsXHJcbiAgVGVtcGxhdGVSZWYsXHJcbiAgVmlld0NoaWxkXHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IENvbnRyb2xWYWx1ZUFjY2Vzc29yLCBOR19WQUxVRV9BQ0NFU1NPUiB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcclxuaW1wb3J0IHsgRm9ybVZhbGlkYXRpb25NZXNzYWdlRGlyZWN0aXZlIH0gZnJvbSAnLi4vZm9ybS12YWxpZGF0aW9uLW1lc3NhZ2UuZGlyZWN0aXZlJztcclxuaW1wb3J0IHsgZW1wdHlGdW5jdGlvbiB9IGZyb20gJy4uL2Zvcm1zLXV0aWwnO1xyXG5pbXBvcnQgeyBNdWx0aVNlbGVjdE9wdGlvbkRpcmVjdGl2ZSwgTXVsdGlTZWxlY3RUaXRsZURpcmVjdGl2ZSB9IGZyb20gJy4uL2Zvcm0tbXVsdGktc2VsZWN0L2Zvcm0tbXVsdGktc2VsZWN0LmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgRk9STV9TRUxFQ1RfU0VMRUNUT1IsIEZvcm1TZWxlY3RBY3Rpb24gfSBmcm9tICcuL2Zvcm0tY3VzdG9tLXNlbGVjdC5tb2RlbCc7XHJcbmltcG9ydCB7IEZvcm1TZWxlY3RPcHRpb25Db21wb25lbnQgfSBmcm9tICcuL2Zvcm0tc2VsZWN0LW9wdGlvbi9mb3JtLXNlbGVjdC1vcHRpb24uY29tcG9uZW50JztcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjdXN0b21TZWxlY3RTZWxlY3RvckZhY3RvcnkoKSB7XHJcbiAgcmV0dXJuIG5ldyBTdWJqZWN0PEZvcm1TZWxlY3RBY3Rpb24+KCk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBUaGlzIGNvbXBvbmVudCBvZmZlcnMgYSBzZWxlY3QgZmllbGQsIHRoYXQgY2FuIGJlIGhlYXZpbHkgY3VzdG9taXplZC5cclxuICogVGhlIGVhc3kgd2F5IHdvdWxkIHRvIGp1c3QgYWRkIG9wdGlvbnMgbGlrZSB0aGlzOlxyXG4gKiA8cmItZm9ybS1zZWxlY3Qtb3B0aW9uIFt2YWx1ZV09XCJcIj48L3JiLWZvcm0tc2VsZWN0LW9wdGlvbj5cclxuICpcclxuICogQnV0IHlvdSBjYW4gYWxzbyBwcm92aWRlIGEgc2VsZWN0aW9uVHBsIHdoaWNoIGlzIGEgbmctdGVtcGxhdGUgdGhhdCBpcyB1c2VkIHRvIHNob3cgdGhlIG9wdGlvbnMgaW4gdGhlIGRyb3Bkb3duLlxyXG4gKiBJdCBnZXRzIGEgY29udGV4dCwgdGhhdCBjb250YWlucyBhIHNlbGVjdCgpIGZ1bmN0aW9uIHRoYXQgY2FuIGJlIHVzZWQgdG8gcHJvdmlkZSB0aGUgdmFsdWUgZm9yIHRoZSBuZ01vZGVsLlxyXG4gKi9cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdyYi1mb3JtLWN1c3RvbS1zZWxlY3QnLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9mb3JtLWN1c3RvbS1zZWxlY3QuY29tcG9uZW50Lmh0bWwnLFxyXG4gIHByb3ZpZGVyczogW1xyXG4gICAge3Byb3ZpZGU6IE5HX1ZBTFVFX0FDQ0VTU09SLCB1c2VFeGlzdGluZzogZm9yd2FyZFJlZigoKSA9PiBGb3JtQ3VzdG9tU2VsZWN0Q29tcG9uZW50KSwgbXVsdGk6IHRydWV9LFxyXG4gICAge3Byb3ZpZGU6IEZPUk1fU0VMRUNUX1NFTEVDVE9SLCB1c2VGYWN0b3J5OiBjdXN0b21TZWxlY3RTZWxlY3RvckZhY3Rvcnl9XHJcbiAgXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgRm9ybUN1c3RvbVNlbGVjdENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95LCBBZnRlclZpZXdJbml0LCBDb250cm9sVmFsdWVBY2Nlc3NvciB7XHJcblxyXG4gIEBJbnB1dCgpIG5hbWU6IHN0cmluZztcclxuXHJcbiAgQElucHV0KCkgbGFiZWw6IHN0cmluZyB8IFRlbXBsYXRlUmVmPGFueT4gPSBudWxsO1xyXG4gIGlkID0gJ2N1c3RvbVNlbGVjdFZhbHVlLicgKyBNYXRoLnJhbmRvbSgpO1xyXG4gIGRpc2FibGVkOiBib29sZWFuO1xyXG5cclxuICBASW5wdXQoKSBzZWxlY3Rpb25UcGw6IFRlbXBsYXRlUmVmPGFueT4gPSBudWxsO1xyXG4gIEBJbnB1dCgpIGF1dG9DbG9zZSA9IHRydWU7XHJcblxyXG4gIEBDb250ZW50Q2hpbGRyZW4oRm9ybVZhbGlkYXRpb25NZXNzYWdlRGlyZWN0aXZlKSBtZXNzYWdlczogUXVlcnlMaXN0PEZvcm1WYWxpZGF0aW9uTWVzc2FnZURpcmVjdGl2ZT47XHJcblxyXG4gIHByaXZhdGUgaXNNb3VzZU92ZXIgPSBmYWxzZTtcclxuXHJcbiAgQENvbnRlbnRDaGlsZChNdWx0aVNlbGVjdE9wdGlvbkRpcmVjdGl2ZSwge3N0YXRpYzogZmFsc2V9KSBvcHRpb246IE11bHRpU2VsZWN0T3B0aW9uRGlyZWN0aXZlO1xyXG4gIEBDb250ZW50Q2hpbGQoTXVsdGlTZWxlY3RUaXRsZURpcmVjdGl2ZSwge3N0YXRpYzogZmFsc2V9KSB0aXRsZTogTXVsdGlTZWxlY3RUaXRsZURpcmVjdGl2ZTtcclxuICBAQ29udGVudENoaWxkcmVuKEZvcm1TZWxlY3RPcHRpb25Db21wb25lbnQpIG9wdGlvbnM6IFF1ZXJ5TGlzdDxGb3JtU2VsZWN0T3B0aW9uQ29tcG9uZW50PjtcclxuXHJcbiAgQFZpZXdDaGlsZCgnYWN0aXZlRWxlbWVudCcsIHtzdGF0aWM6IHRydWV9KSBhY3RpdmVFbGVtZW50OiBFbGVtZW50UmVmO1xyXG5cclxuICBvbkNoYW5nZSA9IGVtcHR5RnVuY3Rpb247XHJcbiAgb25Ub3VjaGVkID0gZW1wdHlGdW5jdGlvbjtcclxuXHJcbiAgdXBkYXRlVmFsdWU7XHJcblxyXG4gIHByaXZhdGUgc2VsZWN0U3ViO1xyXG5cclxuICBwcml2YXRlIHZhbHVlID0gbnVsbDtcclxuXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSByZW5kZXJlcjogUmVuZGVyZXIyLFxyXG4gICAgICAgICAgICAgIHByaXZhdGUgZWxlbWVudFJlZjogRWxlbWVudFJlZixcclxuICAgICAgICAgICAgICBASW5qZWN0KEZPUk1fU0VMRUNUX1NFTEVDVE9SKSBwcml2YXRlIHNlbGVjdFN1YmplY3Q6IFN1YmplY3Q8Rm9ybVNlbGVjdEFjdGlvbj4pIHtcclxuICAgIHRoaXMudXBkYXRlVmFsdWUgPSB2YWx1ZSA9PiB7XHJcbiAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTtcclxuICAgICAgdGhpcy5vbkNoYW5nZSh2YWx1ZSk7XHJcbiAgICAgIHRoaXMuY2hlY2tWYWx1ZSh2YWx1ZSk7XHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICB0aGlzLnNlbGVjdFN1YiA9IHRoaXMuc2VsZWN0U3ViamVjdC5zdWJzY3JpYmUoYWN0aW9uID0+IHtcclxuICAgICAgaWYgKGFjdGlvbi50eXBlID09PSAndXBkYXRlJykge1xyXG4gICAgICAgIHRoaXMudXBkYXRlVmFsdWUoYWN0aW9uLnZhbHVlKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcclxuICAgIGlmICh0aGlzLnNlbGVjdFN1Yikge1xyXG4gICAgICB0aGlzLnNlbGVjdFN1Yi51bnN1YnNjcmliZSgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xyXG4gICAgdGhpcy51cGRhdGVDdXJyZW50TGFiZWwodGhpcy52YWx1ZSk7XHJcbiAgfVxyXG5cclxuICBpc0xhYmVsVGVtcGxhdGUoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5sYWJlbCBpbnN0YW5jZW9mIFRlbXBsYXRlUmVmO1xyXG4gIH1cclxuXHJcbiAgQEhvc3RMaXN0ZW5lcignbW91c2VlbnRlcicpIG1vdXNlb3ZlcigpIHtcclxuICAgIHRoaXMuaXNNb3VzZU92ZXIgPSB0cnVlO1xyXG4gIH1cclxuXHJcbiAgQEhvc3RMaXN0ZW5lcignbW91c2VsZWF2ZScpIG1vdXNlbGVhdmUoKSB7XHJcbiAgICB0aGlzLmlzTW91c2VPdmVyID0gZmFsc2U7XHJcbiAgfVxyXG5cclxuICB3cml0ZVZhbHVlKHZhbHVlOiBhbnkpOiB2b2lkIHtcclxuICAgIHRoaXMudmFsdWUgPSB2YWx1ZTtcclxuICAgIHRoaXMuc2VsZWN0U3ViamVjdC5uZXh0KHt0eXBlOiAnd3JpdGUnLCB2YWx1ZX0pO1xyXG4gICAgdGhpcy5jaGVja1ZhbHVlKHZhbHVlKTtcclxuICB9XHJcblxyXG4gIHJlZ2lzdGVyT25DaGFuZ2UoZm46IChfOiBhbnkpID0+IHt9KTogdm9pZCB7XHJcbiAgICB0aGlzLm9uQ2hhbmdlID0gZm47XHJcbiAgfVxyXG5cclxuICByZWdpc3Rlck9uVG91Y2hlZChmbjogKCkgPT4ge30pOiB2b2lkIHtcclxuICAgIHRoaXMub25Ub3VjaGVkID0gZm47XHJcbiAgfVxyXG5cclxuICBzZXREaXNhYmxlZFN0YXRlKGlzRGlzYWJsZWQ6IGJvb2xlYW4pOiB2b2lkIHtcclxuICAgIHRoaXMuZGlzYWJsZWQgPSBpc0Rpc2FibGVkO1xyXG4gIH1cclxuXHJcbiAgY2hlY2tWYWx1ZSh2YWx1ZSkge1xyXG4gICAgaWYgKHR5cGVvZiAodmFsdWUpID09PSAnc3RyaW5nJyAmJiB2YWx1ZS5sZW5ndGggPiAwIHx8IHR5cGVvZiAodmFsdWUpID09PSAnbnVtYmVyJyB8fCB0eXBlb2YgKHZhbHVlKSA9PT0gJ2Jvb2xlYW4nIHx8IHZhbHVlKSB7XHJcbiAgICAgIHRoaXMucmVuZGVyZXIuYWRkQ2xhc3ModGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQsICdub3QtZW1wdHknKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMucmVuZGVyZXIucmVtb3ZlQ2xhc3ModGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQsICdub3QtZW1wdHknKTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLnVwZGF0ZUN1cnJlbnRMYWJlbCh2YWx1ZSk7XHJcblxyXG5cclxuICB9XHJcblxyXG4gIHVwZGF0ZUN1cnJlbnRMYWJlbCh2YWx1ZSkge1xyXG4gICAgaWYgKHRoaXMub3B0aW9ucyAmJiB0aGlzLm9wdGlvbnMubGVuZ3RoKSB7XHJcbiAgICAgIGNvbnN0IG9wdCA9IHRoaXMub3B0aW9ucy5maW5kKGl0ZW0gPT4gaXRlbS52YWx1ZSA9PT0gdmFsdWUpO1xyXG4gICAgICBpZiAob3B0KSB7XHJcbiAgICAgICAgdGhpcy5hY3RpdmVFbGVtZW50Lm5hdGl2ZUVsZW1lbnQuaW5uZXJIVE1MID0gb3B0LmNvbnRlbnQubmF0aXZlRWxlbWVudC5pbm5lckhUTUw7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG59XHJcbiJdfQ==