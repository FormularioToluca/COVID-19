import * as tslib_1 from "tslib";
var FormMultiSelectComponent_1;
import { Component, ContentChild, ContentChildren, Directive, ElementRef, forwardRef, HostListener, Input, QueryList, Renderer2, TemplateRef } from '@angular/core';
import { FormValidationMessageDirective } from '../form-validation-message.directive';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { emptyFunction } from '../forms-util';
let MultiSelectOptionDirective = class MultiSelectOptionDirective {
    constructor(templateRef) {
        this.templateRef = templateRef;
    }
};
MultiSelectOptionDirective = tslib_1.__decorate([
    Directive({
        selector: '[rbFormMultiSelectOption]'
    }),
    tslib_1.__metadata("design:paramtypes", [TemplateRef])
], MultiSelectOptionDirective);
export { MultiSelectOptionDirective };
let MultiSelectTitleDirective = class MultiSelectTitleDirective {
    constructor(templateRef) {
        this.templateRef = templateRef;
    }
};
MultiSelectTitleDirective = tslib_1.__decorate([
    Directive({
        selector: '[rbFormMultiSelectTitle]'
    }),
    tslib_1.__metadata("design:paramtypes", [TemplateRef])
], MultiSelectTitleDirective);
export { MultiSelectTitleDirective };
/**
 * Use this component to have multiple selections.
 * The value is a map of id -> state.
 * The items are an array of objects.
 * To identify the id of an object from the items array, provide the idField.
 */
let FormMultiSelectComponent = FormMultiSelectComponent_1 = class FormMultiSelectComponent {
    constructor(renderer, elementRef) {
        this.renderer = renderer;
        this.elementRef = elementRef;
        this.label = null;
        this.id = 'multiSelect.' + Math.random();
        this.selectAllLabel = 'Select all';
        this.isMouseOver = false;
        /**
         * Property name of the property that contains the unique value of an item
         * Otherwise the JSON rep is used as value
         */
        this.idField = null;
        /**
         * What states should be offered per item
         * check: just checked(true) and unchecked(false)
         * optCheck: unchecked(null), include(true), exclude(false)
         */
        this.statesMode = 'check';
        this.numStates = 2;
        this._states = {
            'check': [false, true],
            'optCheck': [null, false, true]
        };
        this.maxItemsPreview = 3;
        this.allStates = null;
        this.countNotDefState = 0;
        this.firstNotDefStateItem = null;
        this._value = {};
        this.titleContext = {
            $implicit: null,
            count: 0,
            firstItem: null,
            states: null
        };
        this.onChange = emptyFunction;
        this.onTouched = emptyFunction;
        this.getItemTrackId = (i, item) => {
            return this.getItemId(item.item);
        };
    }
    ngOnInit() {
        const states = this.getStates();
        this.numStates = states.length;
        this.allStates = states[0];
    }
    isLabelTemplate() {
        return this.label instanceof TemplateRef;
    }
    set items(items) {
        const states = this.getStates();
        this._items = items.map(item => {
            const id = this.getItemId(item);
            let state = states[0];
            if (this._value && this._value[id] !== undefined) {
                state = this._value[id];
            }
            return {
                item: item,
                state: state
            };
        });
        this.doOnChanges();
    }
    getItemId(item) {
        if (this.idField && item) {
            return item[this.idField];
        }
        else {
            return JSON.stringify(item);
        }
    }
    getStates() {
        return this._states[this.statesMode];
    }
    allStatesChange(state) {
        this.allStates = state;
        if (!this._items) {
            return;
        }
        this._items.forEach(item => {
            item.state = state;
        });
        this.notifyChanges();
    }
    updateStateOfItem(item, state) {
        item.state = state;
        if (this._items.some(d => d.state !== state)) {
            const states = this.getStates();
            this.allStates = states[0];
        }
        else {
            this.allStates = state;
        }
        this.notifyChanges();
    }
    getCurrentStatesObject() {
        const states = {};
        this._items.forEach(item => {
            const id = this.getItemId(item.item);
            states[id] = item.state;
        });
        return states;
    }
    doOnChanges() {
        this.firstNotDefStateItem = null;
        this.countNotDefState = 0;
        const states = this.getStates();
        if (!this._items) {
            return;
        }
        this._items.forEach(item => {
            if (item.state !== states[0]) {
                this.countNotDefState++;
                if (this.firstNotDefStateItem === null) {
                    this.firstNotDefStateItem = item;
                }
            }
        });
        this.titleContext = {
            $implicit: this._items,
            count: this.countNotDefState,
            firstItem: this.firstNotDefStateItem,
            states: this._value
        };
        if (this.countNotDefState === 0 && this.selectAllLabel === '') {
            this.renderer.removeClass(this.elementRef.nativeElement, 'not-empty');
        }
        else {
            this.renderer.addClass(this.elementRef.nativeElement, 'not-empty');
        }
    }
    notifyChanges() {
        this.doOnChanges();
        this.onChange(this.getCurrentStatesObject());
    }
    mouseover() {
        this.isMouseOver = true;
    }
    mouseleave() {
        this.isMouseOver = false;
    }
    writeValue(items) {
        this._value = items;
        if (items) {
            const states = this.getStates();
            this._items.forEach(item => {
                const id = this.getItemId(item.item);
                if (items[id] !== undefined) {
                    item.state = items[id];
                }
                else {
                    item.state = states[0];
                }
            });
        }
        this.doOnChanges();
    }
    registerOnChange(fn) {
        this.onChange = fn;
    }
    registerOnTouched(fn) {
        this.onTouched = fn;
    }
    setDisabledState(isDisabled) {
        this.disabled = isDisabled;
    }
};
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", String)
], FormMultiSelectComponent.prototype, "name", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", Object)
], FormMultiSelectComponent.prototype, "label", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", Object)
], FormMultiSelectComponent.prototype, "selectAllLabel", void 0);
tslib_1.__decorate([
    ContentChildren(FormValidationMessageDirective),
    tslib_1.__metadata("design:type", QueryList)
], FormMultiSelectComponent.prototype, "messages", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", String)
], FormMultiSelectComponent.prototype, "idField", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", String)
], FormMultiSelectComponent.prototype, "statesMode", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", Object)
], FormMultiSelectComponent.prototype, "maxItemsPreview", void 0);
tslib_1.__decorate([
    ContentChild(MultiSelectOptionDirective, { static: false }),
    tslib_1.__metadata("design:type", MultiSelectOptionDirective)
], FormMultiSelectComponent.prototype, "option", void 0);
tslib_1.__decorate([
    ContentChild(MultiSelectTitleDirective, { static: false }),
    tslib_1.__metadata("design:type", MultiSelectTitleDirective)
], FormMultiSelectComponent.prototype, "title", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", Array),
    tslib_1.__metadata("design:paramtypes", [Array])
], FormMultiSelectComponent.prototype, "items", null);
tslib_1.__decorate([
    HostListener('mouseenter'),
    tslib_1.__metadata("design:type", Function),
    tslib_1.__metadata("design:paramtypes", []),
    tslib_1.__metadata("design:returntype", void 0)
], FormMultiSelectComponent.prototype, "mouseover", null);
tslib_1.__decorate([
    HostListener('mouseleave'),
    tslib_1.__metadata("design:type", Function),
    tslib_1.__metadata("design:paramtypes", []),
    tslib_1.__metadata("design:returntype", void 0)
], FormMultiSelectComponent.prototype, "mouseleave", null);
FormMultiSelectComponent = FormMultiSelectComponent_1 = tslib_1.__decorate([
    Component({
        selector: 'rb-form-multi-select',
        template: "<div class=\"input-wrapper\" [class.no-label]=\"!label\">\r\n\r\n  <button [rbDropdown]=\"dropdownContent\"\r\n          [id]=\"id\"\r\n          [autoClose]=\"false\"\r\n          [disabled]=\"disabled !== undefined\"\r\n          (blur)=\"onTouched()\"\r\n          class=\"rb-select-btn input\">\r\n\r\n    <ng-container *ngIf=\"title\">\r\n      <ng-container *ngTemplateOutlet=\"title.templateRef; context: titleContext\"></ng-container>\r\n    </ng-container>\r\n    <ng-container *ngIf=\"!title\">\r\n      <ng-container *ngIf=\"titleContext.count === 1\">\r\n        <ng-container *ngIf=\"option\">\r\n          <ng-container\r\n            *ngTemplateOutlet=\"option.templateRef; context: {$implicit: titleContext.firstItem.item}\"></ng-container>\r\n        </ng-container>\r\n        <ng-container *ngIf=\"!option\">\r\n          {{titleContext.firstItem.item | json}}\r\n        </ng-container>\r\n      </ng-container>\r\n      <ng-container *ngIf=\"titleContext.count > 1\">{{titleContext.count}} items selected</ng-container>\r\n    </ng-container>\r\n\r\n  </button>\r\n\r\n  <label [for]=\"id\" class=\"label rb-select-label\">\r\n    {{!isLabelTemplate()?label:''}}\r\n    <ng-container *ngIf=\"isLabelTemplate()\">\r\n      <ng-container *ngTemplateOutlet=\"label\"></ng-container>\r\n    </ng-container>\r\n  </label>\r\n  <span class=\"select-icon rb-ic rb-ic-down\"></span>\r\n  <span class=\"input-background\"></span>\r\n</div>\r\n<rb-form-errors [messages]=\"messages\"></rb-form-errors>\r\n\r\n\r\n<ng-template #dropdownContent>\r\n  <ng-container *ngIf=\"selectAllLabel\">\r\n    <rb-form-multi-checkbox [numStates]=\"numStates\"\r\n                            class=\"list-item-input\"\r\n                            [ngModel]=\"allStates\"\r\n                            (ngModelChange)=\"allStatesChange($event)\">\r\n      {{selectAllLabel}}\r\n    </rb-form-multi-checkbox>\r\n    <hr class=\"no-margin\">\r\n  </ng-container>\r\n\r\n  <div class=\"dropdown-limited\">\r\n    <ng-container *ngFor=\"let item of _items; trackBy: getItemTrackId\">\r\n      <rb-form-multi-checkbox [numStates]=\"numStates\"\r\n                              class=\"list-item-input\"\r\n                              [ngModel]=\"item.state\"\r\n                              (ngModelChange)=\"updateStateOfItem(item, $event)\">\r\n        <ng-container *ngIf=\"option\">\r\n          <ng-container *ngTemplateOutlet=\"option.templateRef; context: {$implicit: item.item}\"></ng-container>\r\n        </ng-container>\r\n        <ng-container *ngIf=\"!option\">\r\n          {{item.item | json}}\r\n        </ng-container>\r\n      </rb-form-multi-checkbox>\r\n    </ng-container>\r\n  </div>\r\n\r\n</ng-template>\r\n",
        providers: [{ provide: NG_VALUE_ACCESSOR, useExisting: forwardRef(() => FormMultiSelectComponent_1), multi: true }]
    }),
    tslib_1.__metadata("design:paramtypes", [Renderer2, ElementRef])
], FormMultiSelectComponent);
export { FormMultiSelectComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9ybS1tdWx0aS1zZWxlY3QuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGluc3QtaW90L2Jvc2NoLWFuZ3VsYXItdWktY29tcG9uZW50cy8iLCJzb3VyY2VzIjpbImF0b21zL2Zvcm0tZmllbGRzL2Zvcm0tbXVsdGktc2VsZWN0L2Zvcm0tbXVsdGktc2VsZWN0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLE9BQU8sRUFDTCxTQUFTLEVBQ1QsWUFBWSxFQUNaLGVBQWUsRUFDZixTQUFTLEVBQ1QsVUFBVSxFQUNWLFVBQVUsRUFDVixZQUFZLEVBQ1osS0FBSyxFQUVMLFNBQVMsRUFDVCxTQUFTLEVBQ1QsV0FBVyxFQUNaLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSw4QkFBOEIsRUFBRSxNQUFNLHNDQUFzQyxDQUFDO0FBQ3RGLE9BQU8sRUFBd0IsaUJBQWlCLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUN6RSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBTTlDLElBQWEsMEJBQTBCLEdBQXZDLE1BQWEsMEJBQTBCO0lBRXJDLFlBQW1CLFdBQTZCO1FBQTdCLGdCQUFXLEdBQVgsV0FBVyxDQUFrQjtJQUNoRCxDQUFDO0NBRUYsQ0FBQTtBQUxZLDBCQUEwQjtJQUh0QyxTQUFTLENBQUM7UUFDVCxRQUFRLEVBQUUsMkJBQTJCO0tBQ3RDLENBQUM7NkNBR2dDLFdBQVc7R0FGaEMsMEJBQTBCLENBS3RDO1NBTFksMEJBQTBCO0FBVXZDLElBQWEseUJBQXlCLEdBQXRDLE1BQWEseUJBQXlCO0lBRXBDLFlBQW1CLFdBQTZCO1FBQTdCLGdCQUFXLEdBQVgsV0FBVyxDQUFrQjtJQUNoRCxDQUFDO0NBRUYsQ0FBQTtBQUxZLHlCQUF5QjtJQUhyQyxTQUFTLENBQUM7UUFDVCxRQUFRLEVBQUUsMEJBQTBCO0tBQ3JDLENBQUM7NkNBR2dDLFdBQVc7R0FGaEMseUJBQXlCLENBS3JDO1NBTFkseUJB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SUFBSSxDQUFDLFFBQVEsR0FBRyxVQUFVLENBQUM7SUFDN0IsQ0FBQztDQUVGLENBQUE7QUFoTlU7SUFBUixLQUFLLEVBQUU7O3NEQUFjO0FBQ2I7SUFBUixLQUFLLEVBQUU7O3VEQUF5QztBQUd4QztJQUFSLEtBQUssRUFBRTs7Z0VBQStCO0FBRVU7SUFBaEQsZUFBZSxDQUFDLDhCQUE4QixDQUFDO3NDQUFXLFNBQVM7MERBQWlDO0FBVTVGO0lBQVIsS0FBSyxFQUFFOzt5REFBd0I7QUFPdkI7SUFBUixLQUFLLEVBQUU7OzREQUE0QztBQVMzQztJQUFSLEtBQUssRUFBRTs7aUVBQXFCO0FBRThCO0lBQTFELFlBQVksQ0FBQywwQkFBMEIsRUFBRSxFQUFDLE1BQU0sRUFBRSxLQUFLLEVBQUMsQ0FBQztzQ0FBUywwQkFBMEI7d0RBQUM7QUFDcEM7SUFBekQsWUFBWSxDQUFDLHlCQUF5QixFQUFFLEVBQUMsTUFBTSxFQUFFLEtBQUssRUFBQyxDQUFDO3NDQUFRLHlCQUF5Qjt1REFBQztBQXlDM0Y7SUFEQyxLQUFLLEVBQUU7OztxREFlUDtBQWtGMkI7SUFBM0IsWUFBWSxDQUFDLFlBQVksQ0FBQzs7Ozt5REFFMUI7QUFFMkI7SUFBM0IsWUFBWSxDQUFDLFlBQVksQ0FBQzs7OzswREFFMUI7QUFwTFUsd0JBQXdCO0lBTHBDLFNBQVMsQ0FBQztRQUNULFFBQVEsRUFBRSxzQkFBc0I7UUFDaEMsbXJGQUFpRDtRQUNqRCxTQUFTLEVBQUUsQ0FBQyxFQUFDLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxXQUFXLEVBQUUsVUFBVSxDQUFDLEdBQUcsRUFBRSxDQUFDLDBCQUF3QixDQUFDLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBQyxDQUFDO0tBQ2hILENBQUM7NkNBNEQ4QixTQUFTLEVBQXNCLFVBQVU7R0EzRDVELHdCQUF3QixDQWtOcEM7U0FsTlksd0JBQXdCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICBDb21wb25lbnQsXHJcbiAgQ29udGVudENoaWxkLFxyXG4gIENvbnRlbnRDaGlsZHJlbixcclxuICBEaXJlY3RpdmUsXHJcbiAgRWxlbWVudFJlZixcclxuICBmb3J3YXJkUmVmLFxyXG4gIEhvc3RMaXN0ZW5lcixcclxuICBJbnB1dCxcclxuICBPbkluaXQsXHJcbiAgUXVlcnlMaXN0LFxyXG4gIFJlbmRlcmVyMixcclxuICBUZW1wbGF0ZVJlZlxyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBGb3JtVmFsaWRhdGlvbk1lc3NhZ2VEaXJlY3RpdmUgfSBmcm9tICcuLi9mb3JtLXZhbGlkYXRpb24tbWVzc2FnZS5kaXJlY3RpdmUnO1xyXG5pbXBvcnQgeyBDb250cm9sVmFsdWVBY2Nlc3NvciwgTkdfVkFMVUVfQUNDRVNTT1IgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XHJcbmltcG9ydCB7IGVtcHR5RnVuY3Rpb24gfSBmcm9tICcuLi9mb3Jtcy11dGlsJztcclxuaW1wb3J0IHsgVGFiUGFuZWxUaXRsZURpcmVjdGl2ZSB9IGZyb20gJy4uLy4uLy4uL21vbGVjdWxlcy90YWItcGFuZWwvdGFiLXBhbmVsLXRpdGxlLmRpcmVjdGl2ZSc7XHJcblxyXG5ARGlyZWN0aXZlKHtcclxuICBzZWxlY3RvcjogJ1tyYkZvcm1NdWx0aVNlbGVjdE9wdGlvbl0nXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBNdWx0aVNlbGVjdE9wdGlvbkRpcmVjdGl2ZSB7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHB1YmxpYyB0ZW1wbGF0ZVJlZjogVGVtcGxhdGVSZWY8YW55Pikge1xyXG4gIH1cclxuXHJcbn1cclxuXHJcbkBEaXJlY3RpdmUoe1xyXG4gIHNlbGVjdG9yOiAnW3JiRm9ybU11bHRpU2VsZWN0VGl0bGVdJ1xyXG59KVxyXG5leHBvcnQgY2xhc3MgTXVsdGlTZWxlY3RUaXRsZURpcmVjdGl2ZSB7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHB1YmxpYyB0ZW1wbGF0ZVJlZjogVGVtcGxhdGVSZWY8YW55Pikge1xyXG4gIH1cclxuXHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgSXRlbVdpdGhTdGF0ZSB7XHJcbiAgaXRlbTogYW55O1xyXG4gIHN0YXRlOiBhbnk7XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgU3RhdGVWYWx1ZXMge1xyXG4gIFtrZXk6IHN0cmluZ106IGFueTtcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBUaXRsZUNvbnRleHQge1xyXG4gICRpbXBsaWNpdDogSXRlbVdpdGhTdGF0ZVtdO1xyXG4gIGNvdW50OiBudW1iZXI7XHJcbiAgZmlyc3RJdGVtOiBJdGVtV2l0aFN0YXRlO1xyXG4gIHN0YXRlczogYW55O1xyXG59XHJcblxyXG4vKipcclxuICogVXNlIHRoaXMgY29tcG9uZW50IHRvIGhhdmUgbXVsdGlwbGUgc2VsZWN0aW9ucy5cclxuICogVGhlIHZhbHVlIGlzIGEgbWFwIG9mIGlkIC0+IHN0YXRlLlxyXG4gKiBUaGUgaXRlbXMgYXJlIGFuIGFycmF5IG9mIG9iamVjdHMuXHJcbiAqIFRvIGlkZW50aWZ5IHRoZSBpZCBvZiBhbiBvYmplY3QgZnJvbSB0aGUgaXRlbXMgYXJyYXksIHByb3ZpZGUgdGhlIGlkRmllbGQuXHJcbiAqL1xyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ3JiLWZvcm0tbXVsdGktc2VsZWN0JyxcclxuICB0ZW1wbGF0ZVVybDogJy4vZm9ybS1tdWx0aS1zZWxlY3QuY29tcG9uZW50Lmh0bWwnLFxyXG4gIHByb3ZpZGVyczogW3twcm92aWRlOiBOR19WQUxVRV9BQ0NFU1NPUiwgdXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gRm9ybU11bHRpU2VsZWN0Q29tcG9uZW50KSwgbXVsdGk6IHRydWV9XVxyXG59KVxyXG5leHBvcnQgY2xhc3MgRm9ybU11bHRpU2VsZWN0Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBDb250cm9sVmFsdWVBY2Nlc3NvciB7XHJcblxyXG4gIEBJbnB1dCgpIG5hbWU6IHN0cmluZztcclxuICBASW5wdXQoKSBsYWJlbDogc3RyaW5nIHwgVGVtcGxhdGVSZWY8YW55PiA9IG51bGw7XHJcbiAgaWQgPSAnbXVsdGlTZWxlY3QuJyArIE1hdGgucmFuZG9tKCk7XHJcbiAgZGlzYWJsZWQ6IGJvb2xlYW47XHJcbiAgQElucHV0KCkgc2VsZWN0QWxsTGFiZWwgPSAnU2VsZWN0IGFsbCc7XHJcblxyXG4gIEBDb250ZW50Q2hpbGRyZW4oRm9ybVZhbGlkYXRpb25NZXNzYWdlRGlyZWN0aXZlKSBtZXNzYWdlczogUXVlcnlMaXN0PEZvcm1WYWxpZGF0aW9uTWVzc2FnZURpcmVjdGl2ZT47XHJcblxyXG4gIF9pdGVtczogSXRlbVdpdGhTdGF0ZVtdO1xyXG5cclxuICBwcml2YXRlIGlzTW91c2VPdmVyID0gZmFsc2U7XHJcblxyXG4gIC8qKlxyXG4gICAqIFByb3BlcnR5IG5hbWUgb2YgdGhlIHByb3BlcnR5IHRoYXQgY29udGFpbnMgdGhlIHVuaXF1ZSB2YWx1ZSBvZiBhbiBpdGVtXHJcbiAgICogT3RoZXJ3aXNlIHRoZSBKU09OIHJlcCBpcyB1c2VkIGFzIHZhbHVlXHJcbiAgICovXHJcbiAgQElucHV0KCkgaWRGaWVsZDogc3RyaW5nID0gbnVsbDtcclxuXHJcbiAgLyoqXHJcbiAgICogV2hhdCBzdGF0ZXMgc2hvdWxkIGJlIG9mZmVyZWQgcGVyIGl0ZW1cclxuICAgKiBjaGVjazoganVzdCBjaGVja2VkKHRydWUpIGFuZCB1bmNoZWNrZWQoZmFsc2UpXHJcbiAgICogb3B0Q2hlY2s6IHVuY2hlY2tlZChudWxsKSwgaW5jbHVkZSh0cnVlKSwgZXhjbHVkZShmYWxzZSlcclxuICAgKi9cclxuICBASW5wdXQoKSBzdGF0ZXNNb2RlOiAnY2hlY2snIHwgJ29wdENoZWNrJyA9ICdjaGVjayc7XHJcblxyXG4gIG51bVN0YXRlcyA9IDI7XHJcblxyXG4gIHByaXZhdGUgX3N0YXRlcyA9IHtcclxuICAgICdjaGVjayc6IFtmYWxzZSwgdHJ1ZV0sXHJcbiAgICAnb3B0Q2hlY2snOiBbbnVsbCwgZmFsc2UsIHRydWVdXHJcbiAgfTtcclxuXHJcbiAgQElucHV0KCkgbWF4SXRlbXNQcmV2aWV3ID0gMztcclxuXHJcbiAgQENvbnRlbnRDaGlsZChNdWx0aVNlbGVjdE9wdGlvbkRpcmVjdGl2ZSwge3N0YXRpYzogZmFsc2V9KSBvcHRpb246IE11bHRpU2VsZWN0T3B0aW9uRGlyZWN0aXZlO1xyXG4gIEBDb250ZW50Q2hpbGQoTXVsdGlTZWxlY3RUaXRsZURpcmVjdGl2ZSwge3N0YXRpYzogZmFsc2V9KSB0aXRsZTogTXVsdGlTZWxlY3RUaXRsZURpcmVjdGl2ZTtcclxuXHJcbiAgYWxsU3RhdGVzID0gbnVsbDtcclxuXHJcbiAgcHJpdmF0ZSBjb3VudE5vdERlZlN0YXRlID0gMDtcclxuXHJcbiAgcHJpdmF0ZSBmaXJzdE5vdERlZlN0YXRlSXRlbTogSXRlbVdpdGhTdGF0ZSA9IG51bGw7XHJcblxyXG4gIHByaXZhdGUgX3ZhbHVlOiBTdGF0ZVZhbHVlcyA9IHt9O1xyXG5cclxuICB0aXRsZUNvbnRleHQ6IFRpdGxlQ29udGV4dCA9IHtcclxuICAgICRpbXBsaWNpdDogbnVsbCxcclxuICAgIGNvdW50OiAwLFxyXG4gICAgZmlyc3RJdGVtOiBudWxsLFxyXG4gICAgc3RhdGVzOiBudWxsXHJcbiAgfTtcclxuXHJcbiAgZ2V0SXRlbVRyYWNrSWQ7XHJcblxyXG4gIG9uQ2hhbmdlID0gZW1wdHlGdW5jdGlvbjtcclxuICBvblRvdWNoZWQgPSBlbXB0eUZ1bmN0aW9uO1xyXG5cclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlbmRlcmVyOiBSZW5kZXJlcjIsIHByaXZhdGUgZWxlbWVudFJlZjogRWxlbWVudFJlZikge1xyXG5cclxuICAgIHRoaXMuZ2V0SXRlbVRyYWNrSWQgPSAoaSwgaXRlbSkgPT4ge1xyXG4gICAgICByZXR1cm4gdGhpcy5nZXRJdGVtSWQoaXRlbS5pdGVtKTtcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBuZ09uSW5pdCgpIHtcclxuICAgIGNvbnN0IHN0YXRlcyA9IHRoaXMuZ2V0U3RhdGVzKCk7XHJcbiAgICB0aGlzLm51bVN0YXRlcyA9IHN0YXRlcy5sZW5ndGg7XHJcbiAgICB0aGlzLmFsbFN0YXRlcyA9IHN0YXRlc1swXTtcclxuICB9XHJcblxyXG4gIGlzTGFiZWxUZW1wbGF0ZSgpIHtcclxuICAgIHJldHVybiB0aGlzLmxhYmVsIGluc3RhbmNlb2YgVGVtcGxhdGVSZWY7XHJcbiAgfVxyXG5cclxuXHJcbiAgQElucHV0KClcclxuICBzZXQgaXRlbXMoaXRlbXM6IG9iamVjdFtdKSB7XHJcbiAgICBjb25zdCBzdGF0ZXMgPSB0aGlzLmdldFN0YXRlcygpO1xyXG4gICAgdGhpcy5faXRlbXMgPSBpdGVtcy5tYXAoaXRlbSA9PiB7XHJcbiAgICAgIGNvbnN0IGlkID0gdGhpcy5nZXRJdGVtSWQoaXRlbSk7XHJcbiAgICAgIGxldCBzdGF0ZSA9IHN0YXRlc1swXTtcclxuICAgICAgaWYgKHRoaXMuX3ZhbHVlICYmIHRoaXMuX3ZhbHVlW2lkXSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgc3RhdGUgPSB0aGlzLl92YWx1ZVtpZF07XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBpdGVtOiBpdGVtLFxyXG4gICAgICAgIHN0YXRlOiBzdGF0ZVxyXG4gICAgICB9O1xyXG4gICAgfSk7XHJcbiAgICB0aGlzLmRvT25DaGFuZ2VzKCk7XHJcbiAgfVxyXG5cclxuICBnZXRJdGVtSWQoaXRlbTogYW55KSB7XHJcbiAgICBpZiAodGhpcy5pZEZpZWxkICYmIGl0ZW0pIHtcclxuICAgICAgcmV0dXJuIGl0ZW1bdGhpcy5pZEZpZWxkXTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShpdGVtKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGdldFN0YXRlcygpIHtcclxuICAgIHJldHVybiB0aGlzLl9zdGF0ZXNbdGhpcy5zdGF0ZXNNb2RlXTtcclxuICB9XHJcblxyXG5cclxuICBhbGxTdGF0ZXNDaGFuZ2Uoc3RhdGUpIHtcclxuICAgIHRoaXMuYWxsU3RhdGVzID0gc3RhdGU7XHJcbiAgICBpZiAoIXRoaXMuX2l0ZW1zKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHRoaXMuX2l0ZW1zLmZvckVhY2goaXRlbSA9PiB7XHJcbiAgICAgIGl0ZW0uc3RhdGUgPSBzdGF0ZTtcclxuICAgIH0pO1xyXG4gICAgdGhpcy5ub3RpZnlDaGFuZ2VzKCk7XHJcbiAgfVxyXG5cclxuICB1cGRhdGVTdGF0ZU9mSXRlbShpdGVtOiBJdGVtV2l0aFN0YXRlLCBzdGF0ZSkge1xyXG4gICAgaXRlbS5zdGF0ZSA9IHN0YXRlO1xyXG4gICAgaWYgKHRoaXMuX2l0ZW1zLnNvbWUoZCA9PiBkLnN0YXRlICE9PSBzdGF0ZSkpIHtcclxuICAgICAgY29uc3Qgc3RhdGVzID0gdGhpcy5nZXRTdGF0ZXMoKTtcclxuICAgICAgdGhpcy5hbGxTdGF0ZXMgPSBzdGF0ZXNbMF07XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLmFsbFN0YXRlcyA9IHN0YXRlO1xyXG4gICAgfVxyXG4gICAgdGhpcy5ub3RpZnlDaGFuZ2VzKCk7XHJcbiAgfVxyXG5cclxuICBnZXRDdXJyZW50U3RhdGVzT2JqZWN0KCkge1xyXG4gICAgY29uc3Qgc3RhdGVzID0ge307XHJcbiAgICB0aGlzLl9pdGVtcy5mb3JFYWNoKGl0ZW0gPT4ge1xyXG4gICAgICBjb25zdCBpZCA9IHRoaXMuZ2V0SXRlbUlkKGl0ZW0uaXRlbSk7XHJcbiAgICAgIHN0YXRlc1tpZF0gPSBpdGVtLnN0YXRlO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gc3RhdGVzO1xyXG4gIH1cclxuXHJcbiAgZG9PbkNoYW5nZXMoKSB7XHJcbiAgICB0aGlzLmZpcnN0Tm90RGVmU3RhdGVJdGVtID0gbnVsbDtcclxuICAgIHRoaXMuY291bnROb3REZWZTdGF0ZSA9IDA7XHJcbiAgICBjb25zdCBzdGF0ZXMgPSB0aGlzLmdldFN0YXRlcygpO1xyXG4gICAgaWYgKCF0aGlzLl9pdGVtcykge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICB0aGlzLl9pdGVtcy5mb3JFYWNoKGl0ZW0gPT4ge1xyXG4gICAgICBpZiAoaXRlbS5zdGF0ZSAhPT0gc3RhdGVzWzBdKSB7XHJcbiAgICAgICAgdGhpcy5jb3VudE5vdERlZlN0YXRlKys7XHJcbiAgICAgICAgaWYgKHRoaXMuZmlyc3ROb3REZWZTdGF0ZUl0ZW0gPT09IG51bGwpIHtcclxuICAgICAgICAgIHRoaXMuZmlyc3ROb3REZWZTdGF0ZUl0ZW0gPSBpdGVtO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgdGhpcy50aXRsZUNvbnRleHQgPSB7XHJcbiAgICAgICRpbXBsaWNpdDogdGhpcy5faXRlbXMsXHJcbiAgICAgIGNvdW50OiB0aGlzLmNvdW50Tm90RGVmU3RhdGUsXHJcbiAgICAgIGZpcnN0SXRlbTogdGhpcy5maXJzdE5vdERlZlN0YXRlSXRlbSxcclxuICAgICAgc3RhdGVzOiB0aGlzLl92YWx1ZVxyXG4gICAgfTtcclxuXHJcbiAgICBpZiAodGhpcy5jb3VudE5vdERlZlN0YXRlID09PSAwICYmIHRoaXMuc2VsZWN0QWxsTGFiZWwgPT09ICcnKSB7XHJcbiAgICAgIHRoaXMucmVuZGVyZXIucmVtb3ZlQ2xhc3ModGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQsICdub3QtZW1wdHknKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMucmVuZGVyZXIuYWRkQ2xhc3ModGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQsICdub3QtZW1wdHknKTtcclxuICAgIH1cclxuXHJcbiAgfVxyXG5cclxuICBub3RpZnlDaGFuZ2VzKCkge1xyXG4gICAgdGhpcy5kb09uQ2hhbmdlcygpO1xyXG4gICAgdGhpcy5vbkNoYW5nZSh0aGlzLmdldEN1cnJlbnRTdGF0ZXNPYmplY3QoKSk7XHJcbiAgfVxyXG5cclxuICBASG9zdExpc3RlbmVyKCdtb3VzZWVudGVyJykgbW91c2VvdmVyKCkge1xyXG4gICAgdGhpcy5pc01vdXNlT3ZlciA9IHRydWU7XHJcbiAgfVxyXG5cclxuICBASG9zdExpc3RlbmVyKCdtb3VzZWxlYXZlJykgbW91c2VsZWF2ZSgpIHtcclxuICAgIHRoaXMuaXNNb3VzZU92ZXIgPSBmYWxzZTtcclxuICB9XHJcblxyXG4gIHdyaXRlVmFsdWUoaXRlbXM6IGFueSk6IHZvaWQge1xyXG4gICAgdGhpcy5fdmFsdWUgPSBpdGVtcztcclxuICAgIGlmIChpdGVtcykge1xyXG4gICAgICBjb25zdCBzdGF0ZXMgPSB0aGlzLmdldFN0YXRlcygpO1xyXG4gICAgICB0aGlzLl9pdGVtcy5mb3JFYWNoKGl0ZW0gPT4ge1xyXG4gICAgICAgIGNvbnN0IGlkID0gdGhpcy5nZXRJdGVtSWQoaXRlbS5pdGVtKTtcclxuICAgICAgICBpZiAoaXRlbXNbaWRdICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgIGl0ZW0uc3RhdGUgPSBpdGVtc1tpZF07XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGl0ZW0uc3RhdGUgPSBzdGF0ZXNbMF07XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICAgIHRoaXMuZG9PbkNoYW5nZXMoKTtcclxuICB9XHJcblxyXG4gIHJlZ2lzdGVyT25DaGFuZ2UoZm46IChfOiBhbnkpID0+IHt9KTogdm9pZCB7XHJcbiAgICB0aGlzLm9uQ2hhbmdlID0gZm47XHJcbiAgfVxyXG5cclxuICByZWdpc3Rlck9uVG91Y2hlZChmbjogKCkgPT4ge30pOiB2b2lkIHtcclxuICAgIHRoaXMub25Ub3VjaGVkID0gZm47XHJcbiAgfVxyXG5cclxuICBzZXREaXNhYmxlZFN0YXRlKGlzRGlzYWJsZWQ6IGJvb2xlYW4pOiB2b2lkIHtcclxuICAgIHRoaXMuZGlzYWJsZWQgPSBpc0Rpc2FibGVkO1xyXG4gIH1cclxuXHJcbn1cclxuIl19